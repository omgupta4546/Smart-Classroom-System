[{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\add_institution.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\api\\index.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":3,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":3,"endColumn":7}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const app = require('../server/index.js');\r\n\r\nmodule.exports = app;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\assets\\js\\app.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\assets\\js\\camera.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'scanInterval' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":10,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'faceapi' is not defined.","line":33,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":33,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'faceapi' is not defined.","line":34,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":34,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'faceapi' is not defined.","line":35,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":35,"endColumn":26},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":37,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'faceapi' is not defined.","line":51,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":51,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'faceapi' is not defined.","line":54,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":54,"endColumn":38},{"ruleId":"no-unused-vars","severity":2,"message":"'startAI' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":69,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":69,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"startAI"},"fix":{"range":[2484,3663],"text":""},"desc":"Remove unused variable 'startAI'."}]},{"ruleId":"no-undef","severity":2,"message":"'faceapi' is not defined.","line":82,"column":34,"nodeType":"Identifier","messageId":"undef","endLine":82,"endColumn":41},{"ruleId":"no-undef","severity":2,"message":"'faceapi' is not defined.","line":82,"column":68,"nodeType":"Identifier","messageId":"undef","endLine":82,"endColumn":75},{"ruleId":"no-undef","severity":2,"message":"'faceapi' is not defined.","line":91,"column":35,"nodeType":"Identifier","messageId":"undef","endLine":91,"endColumn":42},{"ruleId":"no-unused-vars","severity":2,"message":"'box' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":105,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":105,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"box"},"fix":{"range":[3806,3846],"text":""},"desc":"Remove unused variable 'box'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'name' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":106,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":106,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"name"},"fix":{"range":[3856,3887],"text":""},"desc":"Remove unused variable 'name'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'saveAttendance' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":138,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":138,"endColumn":30,"suggestions":[{"messageId":"removeVar","data":{"varName":"saveAttendance"},"fix":{"range":[5075,5295],"text":""},"desc":"Remove unused variable 'saveAttendance'."}]}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// camera.js - Client Side High-Accuracy Face Recognition\r\nconst video = document.getElementById('video-feed');\r\nconst overlay = document.getElementById('overlay-container');\r\nconst logList = document.getElementById('log-list');\r\nconst presentCount = document.getElementById('count-present');\r\nconst loadingSpinner = document.getElementById('loading-ai');\r\n\r\nlet labeledFaceDescriptors = []; // To store loaded known faces\r\nlet faceMatcher;\r\nlet scanInterval;\r\nlet isModelLoaded = false;\r\nlet detectedStudents = new Set(); // Track present IDs\r\n\r\n// 1. Init Camera\r\nasync function initCamera() {\r\n    try {\r\n        const stream = await navigator.mediaDevices.getUserMedia({ video: {} });\r\n        video.srcObject = stream;\r\n    } catch (err) {\r\n        console.error(\"Camera Error:\", err);\r\n        alert(\"Camera access denied.\");\r\n    }\r\n}\r\n\r\n// 2. Load Models & Known Faces\r\nasync function loadAI() {\r\n    loadingSpinner.style.display = 'block';\r\n    const MODEL_URL = 'https://justadudewhohacks.github.io/face-api.js/models';\r\n\r\n    if (!isModelLoaded) {\r\n        try {\r\n            console.log(\"Loading models...\");\r\n            await faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL);\r\n            await faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL);\r\n            await faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL);\r\n            isModelLoaded = true;\r\n        } catch (e) {\r\n            alert(\"Failed to load AI models\");\r\n            return false;\r\n        }\r\n    }\r\n\r\n    try {\r\n        console.log(\"Fetching student data...\");\r\n        const response = await fetch('api/get_faces.php');\r\n        const data = await response.json();\r\n\r\n        if (data.status === 'success' && data.students.length > 0) {\r\n            labeledFaceDescriptors = data.students.map(student => {\r\n                const descriptor = new Float32Array(student.descriptor);\r\n                return new faceapi.LabeledFaceDescriptors(student.name, [descriptor]);\r\n            });\r\n\r\n            faceMatcher = new faceapi.FaceMatcher(labeledFaceDescriptors, 0.5); // 0.5 = strict distance\r\n            return true;\r\n        } else {\r\n            alert(\"No students found with registered faces! Please tell students to register Face ID.\");\r\n            loadingSpinner.style.display = 'none';\r\n            return false;\r\n        }\r\n    } catch (e) {\r\n        console.error(e);\r\n        alert(\"Error fetching student database.\");\r\n        return false;\r\n    }\r\n}\r\n\r\n// 3. Start Scanning\r\nasync function startAI() {\r\n    const success = await loadAI();\r\n    if (!success) return;\r\n\r\n    loadingSpinner.style.display = 'none';\r\n    document.getElementById('btn-scan').style.display = 'none';\r\n    document.getElementById('btn-confirm').style.display = 'inline-block';\r\n\r\n    // Loop\r\n    scanInterval = setInterval(async () => {\r\n        if (video.paused || video.ended) return;\r\n\r\n        // Detect all faces\r\n        const detections = await faceapi.detectAllFaces(video, new faceapi.SsdMobilenetv1Options({ minConfidence: 0.5 }))\r\n            .withFaceLandmarks()\r\n            .withFaceDescriptors();\r\n\r\n        // Resize\r\n        const displaySize = { width: video.videoWidth, height: video.videoHeight };\r\n        // We might need to adjust overlay size if video size changed\r\n        // faceapi.matchDimensions(overlay, displaySize); // (Optional if we mapped overlay 1:1)\r\n\r\n        const resizedDetections = faceapi.resizeResults(detections, displaySize);\r\n\r\n        // Match\r\n        const results = resizedDetections.map(d => faceMatcher.findBestMatch(d.descriptor));\r\n\r\n        updateOverlay(results, resizedDetections);\r\n\r\n    }, 200); // 5 FPS is enough\r\n}\r\n\r\nfunction updateOverlay(results, detections) {\r\n    overlay.innerHTML = ''; // Clear rects\r\n\r\n    results.forEach((result, i) => {\r\n        const box = detections[i].detection.box;\r\n        const name = result.toString(); // e.g. \"John Doe (0.42)\"\r\n        const label = result.label;\r\n\r\n        // Draw Box (Simple DIVs)\r\n        // Note: Video scaling in CSS means we need to be careful with coordinate mapping.\r\n        // For simplicity, we assume video is fit to container. If object-fit: cover is used, coordinates shift.\r\n        // A robust solution uses a canvas overlay. Here we just log logic.\r\n\r\n        if (label !== 'unknown') {\r\n            if (!detectedStudents.has(label)) {\r\n                detectedStudents.add(label);\r\n                addLog(label, (1 - result.distance).toFixed(2));\r\n                presentCount.innerText = detectedStudents.size;\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction addLog(name, confidence) {\r\n    const li = document.createElement('li');\r\n    li.className = 'glass-panel';\r\n    li.style.padding = '8px';\r\n    li.style.marginBottom = '5px';\r\n    li.style.display = 'flex';\r\n    li.style.justifyContent = 'space-between';\r\n    li.innerHTML = `\r\n        <span>${name}</span>\r\n        <span class=\"chip success\" style=\"margin:0; padding: 2px 8px; font-size: 10px;\">${Math.round(confidence * 100)}%</span>\r\n    `;\r\n    logList.prepend(li); // Newest top\r\n}\r\n\r\nasync function saveAttendance() {\r\n    // In real app: Send detectedStudents array to API\r\n    alert(`Attendance Saved! Marked ${detectedStudents.size} students present.`);\r\n    window.location.href = 'dashboard.php';\r\n}\r\n\r\ninitCamera();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\ensure_admin.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":15,"column":32,"nodeType":"Identifier","messageId":"undef","endLine":15,"endColumn":39},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":41,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":41,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":44,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":44,"endColumn":16}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import mongoose from 'mongoose';\r\nimport User from './server/models/User.js';\r\nimport dotenv from 'dotenv';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\ndotenv.config({ path: path.join(__dirname, 'server', '.env') });\r\n\r\nconst createOrUpdateAdmin = async () => {\r\n    try {\r\n        await mongoose.connect(process.env.MONGO_URI);\r\n        console.log('Connected to MongoDB');\r\n\r\n        let admin = await User.findOne({ role: 'admin' });\r\n\r\n        if (admin) {\r\n            console.log('Admin found:', admin.email);\r\n            // Optional: Reset password to 'admin123' to ensure we know it\r\n            const salt = await bcrypt.genSalt(10);\r\n            admin.password = await bcrypt.hash('admin123', salt);\r\n            await admin.save();\r\n            console.log('Admin password reset to: admin123');\r\n        } else {\r\n            console.log('No admin found. Creating one...');\r\n            const salt = await bcrypt.genSalt(10);\r\n            const hashedPassword = await bcrypt.hash('admin123', salt);\r\n\r\n            admin = new User({\r\n                name: 'Admin User',\r\n                email: 'admin@example.com',\r\n                password: hashedPassword,\r\n                role: 'admin'\r\n            });\r\n            await admin.save();\r\n            console.log('Admin created: admin@example.com / admin123');\r\n        }\r\n        process.exit(0);\r\n    } catch (err) {\r\n        console.error('Error:', err);\r\n        process.exit(1);\r\n    }\r\n};\r\n\r\ncreateOrUpdateAdmin();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\init_multitenancy.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\list_users.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\list_users.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":12,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":12,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":16,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":20,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":20,"endColumn":16}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import mongoose from 'mongoose';\r\nimport User from './server/models/User.js';\r\nimport dotenv from 'dotenv';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\ndotenv.config({ path: path.join(__dirname, 'server', '.env') });\r\n\r\nmongoose.connect(process.env.MONGO_URI)\r\n    .then(async () => {\r\n        const users = await User.find({}, 'email role password'); // Include password to check if hashed\r\n        console.log(JSON.stringify(users, null, 2));\r\n        process.exit(0);\r\n    })\r\n    .catch(err => {\r\n        console.error('Error:', err);\r\n        process.exit(1);\r\n    });\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\make_admin.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\index.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":2,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":2,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":3,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":3,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":4,"column":16,"nodeType":"Identifier","messageId":"undef","endLine":4,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":5,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":5,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'__dirname' is not defined.","line":7,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":7,"endColumn":42},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":10,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":10,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":20,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":20,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":30,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":30,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":31,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":31,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":32,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":32,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":33,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":33,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":36,"column":23,"nodeType":"Identifier","messageId":"undef","endLine":36,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":40,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":40,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":41,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":41,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":43,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":43,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":43,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":43,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":49,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":49,"endColumn":7}],"suppressedMessages":[],"errorCount":18,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const express = require('express');\r\nconst mongoose = require('mongoose');\r\nconst cors = require('cors');\r\nconst dotenv = require('dotenv');\r\nconst path = require('path');\r\n\r\ndotenv.config({ path: path.join(__dirname, '.env') });\r\n\r\nconst app = express();\r\nconst PORT = process.env.PORT || 5000;\r\n\r\n// Middleware\r\napp.use(cors({\r\n    origin: '*',\r\n    credentials: true\r\n}));\r\napp.use(express.json({ limit: '50mb' }));\r\n\r\n// Database Connection\r\nmongoose.connect(process.env.MONGO_URI)\r\n    .then(() => console.log('MongoDB Connected Successfully'))\r\n    .catch(err => console.error('MongoDB Connection Error:', err));\r\n\r\n// Routes\r\napp.get('/', (req, res) => {\r\n    res.send('Attendance API Running');\r\n});\r\n\r\n// Import Routes\r\nconst authRoutes = require('./routes/auth.js');\r\nconst classRoutes = require('./routes/class.js');\r\nconst adminRoutes = require('./routes/admin.js');\r\nconst institutionRoutes = require('./routes/institution.js');\r\n\r\napp.use('/api/auth', authRoutes);\r\napp.use('/api/users', require('./routes/users.js'));\r\napp.use('/api/classes', classRoutes);\r\napp.use('/api/admin', adminRoutes);\r\napp.use('/api/institutions', institutionRoutes);\r\napp.use('/api/notifications', require('./routes/notifications.js'));\r\napp.use('/api/logs', require('./routes/logs.js'));\r\n\r\nif (require.main === module) {\r\n    app.listen(PORT, () => {\r\n        console.log(`Server running on port ${PORT}`);\r\n    });\r\n}\r\n\r\nmodule.exports = app;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\models\\Attendance.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":30,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":30,"endColumn":7}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const mongoose = require('mongoose');\r\n\r\nconst AttendanceSchema = new mongoose.Schema({\r\n    classId: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Class',\r\n        required: true\r\n    },\r\n    date: {\r\n        type: Date,\r\n        default: Date.now\r\n    },\r\n    records: [{\r\n        student: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'User'\r\n        },\r\n        status: {\r\n            type: String,\r\n            enum: ['present', 'absent'],\r\n            default: 'absent'\r\n        },\r\n        timestamp: {\r\n            type: Date,\r\n            default: Date.now\r\n        }\r\n    }]\r\n});\r\n\r\nmodule.exports = mongoose.model('Attendance', AttendanceSchema);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\models\\AuditLog.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":32,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":32,"endColumn":7}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const mongoose = require('mongoose');\r\n\r\nconst AuditLogSchema = new mongoose.Schema({\r\n    action: {\r\n        type: String, // e.g., \"DELETE_USER\", \"UPDATE_CLASS\"\r\n        required: true\r\n    },\r\n    performedBy: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User',\r\n        required: true\r\n    },\r\n    target: {\r\n        type: String, // Description or ID of what was affected\r\n        required: true\r\n    },\r\n    institutionId: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Institution',\r\n        default: null\r\n    },\r\n    details: {\r\n        type: Object,\r\n        default: {}\r\n    },\r\n    timestamp: {\r\n        type: Date,\r\n        default: Date.now\r\n    }\r\n});\r\n\r\nmodule.exports = mongoose.model('AuditLog', AuditLogSchema);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\models\\Class.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":56,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":56,"endColumn":7}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const mongoose = require('mongoose');\r\n\r\nconst ClassSchema = new mongoose.Schema({\r\n    name: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    subjectName: {\r\n        type: String,\r\n        default: ''\r\n    },\r\n    code: {\r\n        type: String,\r\n        required: true,\r\n        unique: true\r\n    },\r\n    institutionId: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Institution',\r\n        required: true\r\n    },\r\n    professor: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User',\r\n        required: true\r\n    },\r\n    students: [{\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User'\r\n    }],\r\n    createdAt: {\r\n        type: Date,\r\n        default: Date.now\r\n    },\r\n    minAttendance: {\r\n        type: Number,\r\n        default: 75\r\n    },\r\n    announcements: [{\r\n        text: String,\r\n        author: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },\r\n        createdAt: { type: Date, default: Date.now }\r\n    }],\r\n    assignments: [{\r\n        title: String,\r\n        dueDate: Date,\r\n        createdAt: { type: Date, default: Date.now }\r\n    }],\r\n    notes: [{\r\n        title: String,\r\n        link: String,\r\n        createdAt: { type: Date, default: Date.now }\r\n    }]\r\n});\r\n\r\nmodule.exports = mongoose.model('Class', ClassSchema);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\models\\Institution.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":30,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":30,"endColumn":7}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const mongoose = require('mongoose');\r\n\r\nconst InstitutionSchema = new mongoose.Schema({\r\n    name: {\r\n        type: String,\r\n        required: true,\r\n        unique: true\r\n    },\r\n    code: {\r\n        type: String, // e.g., \"IITD\", \"MIT\"\r\n        required: true,\r\n        unique: true,\r\n        uppercase: true\r\n    },\r\n    address: {\r\n        type: String,\r\n        default: ''\r\n    },\r\n    adminId: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User',\r\n        default: null\r\n    },\r\n    createdAt: {\r\n        type: Date,\r\n        default: Date.now\r\n    }\r\n});\r\n\r\nmodule.exports = mongoose.model('Institution', InstitutionSchema);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\models\\Notification.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":36,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":36,"endColumn":7}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const mongoose = require('mongoose');\r\n\r\nconst NotificationSchema = new mongoose.Schema({\r\n    recipient: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User',\r\n        required: true\r\n    },\r\n    title: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    message: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    type: {\r\n        type: String,\r\n        enum: ['attendance', 'class', 'assignment', 'note', 'update', 'absence'],\r\n        default: 'update'\r\n    },\r\n    link: {\r\n        type: String,\r\n        default: ''\r\n    },\r\n    isRead: {\r\n        type: Boolean,\r\n        default: false\r\n    },\r\n    createdAt: {\r\n        type: Date,\r\n        default: Date.now\r\n    }\r\n});\r\n\r\nmodule.exports = mongoose.model('Notification', NotificationSchema);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\models\\User.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":61,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":61,"endColumn":7}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const mongoose = require('mongoose');\r\n\r\nconst UserSchema = new mongoose.Schema({\r\n    name: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    email: {\r\n        type: String,\r\n        required: true,\r\n        unique: true\r\n    },\r\n    password: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    role: {\r\n        type: String,\r\n        enum: ['student', 'professor', 'college_admin', 'super_admin'],\r\n        default: 'student'\r\n    },\r\n    institutionId: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Institution',\r\n        default: null\r\n    },\r\n    rollNo: {\r\n        type: String,\r\n        default: ''\r\n    },\r\n    universityRollNo: {\r\n        type: String,\r\n        default: ''\r\n    },\r\n    classRollNo: {\r\n        type: String,\r\n        default: ''\r\n    },\r\n    faceDescriptor: {\r\n        type: [Number], // Array of 128 floats\r\n        default: null\r\n    },\r\n    googleId: {\r\n        type: String,\r\n        default: null\r\n    },\r\n    isFaceRegistered: {\r\n        type: Boolean,\r\n        default: false\r\n    },\r\n    profilePic: {\r\n        type: String,\r\n        default: ''\r\n    },\r\n    createdAt: {\r\n        type: Date,\r\n        default: Date.now\r\n    }\r\n});\r\n\r\nmodule.exports = mongoose.model('User', UserSchema);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\routes\\admin.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":3,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":3,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":4,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":4,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":5,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":5,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":6,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":6,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":16,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":50},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":22,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":71,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":71,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":83,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":83,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":95,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":95,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":182,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":182,"endColumn":7}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const express = require('express');\r\nconst router = express.Router();\r\nconst User = require('../models/User.js');\r\nconst Class = require('../models/Class.js');\r\nconst Attendance = require('../models/Attendance.js');\r\nconst jwt = require('jsonwebtoken');\r\n\r\n// Middleware to check if user is admin\r\n// Middleware to check if user is admin (Super or College)\r\nconst isAdmin = (req, res, next) => {\r\n    const token = req.header('x-auth-token');\r\n    console.log(\"Admin Middleware Reached. Token:\", token ? \"Present\" : \"Missing\");\r\n    if (!token) return res.status(401).json({ msg: 'No token, authorization denied' });\r\n\r\n    try {\r\n        const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n        if (decoded.user.role !== 'admin' && decoded.user.role !== 'super_admin' && decoded.user.role !== 'college_admin') {\r\n            return res.status(403).json({ msg: 'Admin access denied' });\r\n        }\r\n        req.user = decoded.user;\r\n        next();\r\n    } catch (err) {\r\n        res.status(401).json({ msg: 'Token is not valid' });\r\n    }\r\n};\r\n\r\n// @route   GET /api/admin/stats\r\n// @desc    Get system-wide stats (Filtered for College Admins)\r\n// @access  Admin\r\nrouter.get('/stats', isAdmin, async (req, res) => {\r\n    try {\r\n        let query = {};\r\n        if (req.user.role === 'college_admin') {\r\n            query.institutionId = req.user.institutionId;\r\n        }\r\n\r\n        const totalUsers = await User.countDocuments(query);\r\n        const totalClasses = await Class.countDocuments(query);\r\n        // Note: Attendance logs don't directly have institutionId, filtering them is complex.\r\n        // For now, we'll show total logs (or would need to aggregate via Class lookup)\r\n        const totalAttendanceLogs = await Attendance.countDocuments();\r\n\r\n        const professors = await User.countDocuments({ ...query, role: 'professor' });\r\n        const students = await User.countDocuments({ ...query, role: 'student' });\r\n\r\n        res.json({\r\n            users: { total: totalUsers, professors, students },\r\n            classes: totalClasses,\r\n            attendanceLogs: totalAttendanceLogs\r\n        });\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   GET /api/admin/users\r\n// @desc    Get all users (Filtered)\r\n// @access  Admin\r\nrouter.get('/users', isAdmin, async (req, res) => {\r\n    try {\r\n        let query = {};\r\n        if (req.user.role === 'college_admin') {\r\n            query.institutionId = req.user.institutionId;\r\n        } else if (req.user.role === 'super_admin') {\r\n            // Super admin sees all, or can filter? For now sees all.\r\n        }\r\n\r\n        const users = await User.find(query).select('-password').populate('institutionId', 'name').sort({ createdAt: -1 });\r\n        res.json(users);\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   DELETE /api/admin/user/:id\r\n// @desc    Delete a user\r\n// @access  Admin\r\nrouter.delete('/user/:id', isAdmin, async (req, res) => {\r\n    try {\r\n        await User.findByIdAndDelete(req.params.id);\r\n        res.json({ msg: 'User deleted' });\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   GET /api/admin/classes\r\n// @desc    Get all classes\r\n// @access  Admin\r\nrouter.get('/classes', isAdmin, async (req, res) => {\r\n    try {\r\n        const classes = await Class.find().populate('professor', 'name email').sort({ createdAt: -1 });\r\n        res.json(classes);\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   GET /api/admin/analytics/users\r\n// @desc    Get new users per day for last 7 days\r\n// @access  Admin\r\nrouter.get('/analytics/users', isAdmin, async (req, res) => {\r\n    try {\r\n        const sevenDaysAgo = new Date();\r\n        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\r\n\r\n        const analytics = await User.aggregate([\r\n            { $match: { createdAt: { $gte: sevenDaysAgo } } },\r\n            {\r\n                $group: {\r\n                    _id: { $dateToString: { format: \"%Y-%m-%d\", date: \"$createdAt\" } },\r\n                    count: { $sum: 1 }\r\n                }\r\n            },\r\n            { $sort: { _id: 1 } }\r\n        ]);\r\n\r\n        // Fill in missing days\r\n        const labels = [];\r\n        for (let i = 6; i >= 0; i--) {\r\n            const date = new Date();\r\n            date.setDate(date.getDate() - i);\r\n            labels.push(date.toISOString().split('T')[0]);\r\n        }\r\n\r\n        const data = labels.map(label => {\r\n            const found = analytics.find(a => a._id === label);\r\n            return { name: label.split('-').slice(1).join('/'), value: found ? found.count : 0 };\r\n        });\r\n\r\n        res.json(data);\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   GET /api/admin/analytics/attendance\r\n// @desc    Get global attendance percentage per day for last 7 days\r\n// @access  Admin\r\nrouter.get('/analytics/attendance', isAdmin, async (req, res) => {\r\n    try {\r\n        const sevenDaysAgo = new Date();\r\n        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\r\n\r\n        const analytics = await Attendance.aggregate([\r\n            { $match: { date: { $gte: sevenDaysAgo } } },\r\n            {\r\n                $group: {\r\n                    _id: { $dateToString: { format: \"%Y-%m-%d\", date: \"$date\" } },\r\n                    totalPresent: { $sum: { $size: \"$records\" } },\r\n                    sessionCount: { $sum: 1 }\r\n                }\r\n            },\r\n            { $sort: { _id: 1 } }\r\n        ]);\r\n\r\n        // Note: For real percentage, we'd need total students in those classes.\r\n        // For a simple demo/v1, we'll show average \"present students per session\" or a normalized value.\r\n        // Let's just show total present students across all sessions that day for simplicity in this demo environment.\r\n\r\n        const labels = [];\r\n        for (let i = 6; i >= 0; i--) {\r\n            const date = new Date();\r\n            date.setDate(date.getDate() - i);\r\n            labels.push(date.toISOString().split('T')[0]);\r\n        }\r\n\r\n        const data = labels.map(label => {\r\n            const found = analytics.find(a => a._id === label);\r\n            return { name: label.split('-').slice(1).join('/'), value: found ? found.totalPresent : 0 };\r\n        });\r\n\r\n        res.json(data);\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\nmodule.exports = router;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\routes\\auth.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":3,"column":16,"nodeType":"Identifier","messageId":"undef","endLine":3,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":4,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":4,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":5,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":5,"endColumn":21},{"ruleId":"no-unused-vars","severity":2,"message":"'fs' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":6,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"fs"},"fix":{"range":[190,215],"text":""},"desc":"Remove unused variable 'fs'."}]},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":6,"column":12,"nodeType":"Identifier","messageId":"undef","endLine":6,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'path' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":7,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":11,"suggestions":[{"messageId":"removeVar","data":{"varName":"path"},"fix":{"range":[217,246],"text":""},"desc":"Remove unused variable 'path'."}]},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":7,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":7,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":28,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":28,"endColumn":40},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":45,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":45,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":68,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":68,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":86,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":86,"endColumn":50},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":89,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":89,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":95,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":95,"endColumn":33},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":96,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":96,"endColumn":40},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":103,"column":23,"nodeType":"Identifier","messageId":"undef","endLine":103,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":128,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":128,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":139,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":139,"endColumn":7}],"suppressedMessages":[],"errorCount":18,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const express = require('express');\r\nconst router = express.Router();\r\nconst bcrypt = require('bcryptjs');\r\nconst jwt = require('jsonwebtoken');\r\nconst User = require('../models/User.js');\r\nconst fs = require('fs');\r\nconst path = require('path');\r\n\r\n// Register\r\nrouter.post('/register', async (req, res) => {\r\n    const { name, email, password, role, rollNo, key, institutionId } = req.body;\r\n\r\n    // Simple Professor Key Check (Demo)\r\n    if (role === 'professor' && key !== 'admin123') {\r\n        return res.status(403).json({ msg: 'Invalid Professor Key' });\r\n    }\r\n\r\n    try {\r\n        let user = await User.findOne({ email });\r\n        if (user) return res.status(400).json({ msg: 'User already exists' });\r\n\r\n        const salt = await bcrypt.genSalt(10);\r\n        const hashedPassword = await bcrypt.hash(password, salt);\r\n\r\n        // Default Institution Handling\r\n        let finalInstitutionId = institutionId;\r\n        if (!finalInstitutionId) {\r\n            const Institution = require('../models/Institution.js');\r\n            const defaultInst = await Institution.findOne({ code: 'DEFAULT' });\r\n            if (defaultInst) finalInstitutionId = defaultInst._id;\r\n        }\r\n\r\n        user = new User({\r\n            name,\r\n            email,\r\n            password: hashedPassword,\r\n            role,\r\n            rollNo,\r\n            institutionId: finalInstitutionId\r\n        });\r\n\r\n        await user.save();\r\n\r\n        const payload = { user: { id: user.id, role: user.role, institutionId: user.institutionId } };\r\n        jwt.sign(payload, process.env.JWT_SECRET, { expiresIn: '7d' }, (err, token) => {\r\n            if (err) throw err;\r\n            res.json({ token, user: { id: user.id, name: user.name, role: user.role, institutionId: user.institutionId } });\r\n        });\r\n\r\n    } catch (err) {\r\n        console.error(err.message);\r\n        res.status(500).send('Server error');\r\n    }\r\n});\r\n\r\n// Login\r\nrouter.post('/login', async (req, res) => {\r\n    const { email, password } = req.body;\r\n\r\n    try {\r\n        let user = await User.findOne({ email });\r\n        if (!user) return res.status(400).json({ msg: 'Invalid Credentials' });\r\n\r\n        const isMatch = await bcrypt.compare(password, user.password);\r\n        if (!isMatch) return res.status(400).json({ msg: 'Invalid Credentials' });\r\n\r\n        const payload = { user: { id: user.id, role: user.role, institutionId: user.institutionId } };\r\n        jwt.sign(payload, process.env.JWT_SECRET, { expiresIn: '7d' }, (err, token) => {\r\n            if (err) throw err;\r\n            res.json({ token, user: { id: user.id, name: user.name, role: user.role, institutionId: user.institutionId } });\r\n        });\r\n\r\n    } catch (err) {\r\n        console.error(err.message);\r\n        res.status(500).send('Server error');\r\n    }\r\n});\r\n\r\n// Get User (Projected)\r\nrouter.get('/me', async (req, res) => {\r\n    // Middleware would usually handle this, but for speed simplified\r\n    const token = req.header('x-auth-token');\r\n    if (!token) return res.status(401).json({ msg: 'No token, authorization denied' });\r\n\r\n    try {\r\n        const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n        const user = await User.findById(decoded.user.id).select('-password').populate('institutionId', 'name');\r\n        res.json(user);\r\n    } catch (err) {\r\n        res.status(401).json({ msg: 'Token is not valid' });\r\n    }\r\n});\r\n\r\n// Google Login\r\nconst { OAuth2Client } = require('google-auth-library');\r\nconst client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);\r\n\r\nrouter.post('/google', async (req, res) => {\r\n    const { token } = req.body;\r\n    try {\r\n        const ticket = await client.verifyIdToken({\r\n            idToken: token,\r\n            audience: process.env.GOOGLE_CLIENT_ID\r\n        });\r\n        const { name, email, sub } = ticket.getPayload(); // sub is googleId\r\n\r\n        let user = await User.findOne({ email });\r\n\r\n        if (user) {\r\n            // Link Google ID if not linked\r\n            if (!user.googleId) {\r\n                user.googleId = sub;\r\n                await user.save();\r\n            }\r\n        } else {\r\n            // Create new Google user\r\n            user = new User({\r\n                name,\r\n                email,\r\n                password: 'google_login_no_password', // Dummy password\r\n                googleId: sub,\r\n                role: 'student' // Default role\r\n            });\r\n            await user.save();\r\n        }\r\n\r\n        const payload = { user: { id: user.id, role: user.role } };\r\n        jwt.sign(payload, process.env.JWT_SECRET, { expiresIn: '7d' }, (err, jwtToken) => {\r\n            if (err) throw err;\r\n            res.json({ token: jwtToken, user: { id: user.id, name: user.name, role: user.role } });\r\n        });\r\n\r\n    } catch (err) {\r\n        console.error(err.message);\r\n        res.status(500).send('Google Auth Failed');\r\n    }\r\n});\r\n\r\nmodule.exports = router;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\routes\\class.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":3,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":3,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":4,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":4,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":5,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":5,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":6,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":6,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":7,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":7,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":8,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":8,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":9,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":9,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":10,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":10,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":16,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":17,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":17,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":26,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":26,"endColumn":50},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":29,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":15},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":316,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":316,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":537,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":537,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":559,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":559,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":574,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":574,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":588,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":588,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":600,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":600,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":679,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":679,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":719,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":719,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":748,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":748,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":777,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":777,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":806,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":806,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":811,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":811,"endColumn":7}],"suppressedMessages":[],"errorCount":25,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const express = require('express');\r\nconst router = express.Router();\r\nconst Class = require('../models/Class.js');\r\nconst User = require('../models/User.js');\r\nconst Attendance = require('../models/Attendance.js');\r\nconst Notification = require('../models/Notification.js');\r\nconst jwt = require('jsonwebtoken');\r\nconst logAction = require('../utils/logger.js');\r\nconst nodemailer = require('nodemailer');\r\nconst mongoose = require('mongoose');\r\n\r\n// Email Transporter (Configure with your SMTP)\r\nconst transporter = nodemailer.createTransport({\r\n    service: 'gmail',\r\n    auth: {\r\n        user: process.env.EMAIL_USER || 'your-email@gmail.com',\r\n        pass: process.env.EMAIL_PASS || 'your-password'\r\n    }\r\n});\r\n\r\n// Middleware to check token\r\nconst auth = (req, res, next) => {\r\n    const token = req.header('x-auth-token');\r\n    if (!token) return res.status(401).json({ msg: 'No token' });\r\n    try {\r\n        const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n        req.user = decoded.user;\r\n        next();\r\n    } catch (e) {\r\n        res.status(401).json({ msg: 'Token invalid' });\r\n    }\r\n};\r\n\r\n// --- STATIC ANALYTICS ROUTES (Must be before parameterized routes) ---\r\n\r\n// @route   GET /api/classes/analytics/attendance\r\n// @desc    Get attendance analytics for last 14 days\r\n// @access  Private\r\nrouter.get('/analytics/attendance', auth, async (req, res) => {\r\n    try {\r\n        const historyDays = 14;\r\n        const startDate = new Date();\r\n        startDate.setDate(startDate.getDate() - historyDays);\r\n\r\n        let analytics, classes;\r\n        if (req.user.role === 'professor') {\r\n            classes = await Class.find({ professor: req.user.id });\r\n        } else {\r\n            classes = await Class.find({ students: req.user.id });\r\n        }\r\n        const classIds = classes.map(c => c._id);\r\n\r\n        if (req.user.role === 'professor') {\r\n            analytics = await Attendance.aggregate([\r\n                { $match: { classId: { $in: classIds }, date: { $gte: startDate } } },\r\n                {\r\n                    $lookup: {\r\n                        from: 'classes',\r\n                        localField: 'classId',\r\n                        foreignField: '_id',\r\n                        as: 'classInfo'\r\n                    }\r\n                },\r\n                { $unwind: '$classInfo' },\r\n                {\r\n                    $group: {\r\n                        _id: { $dateToString: { format: \"%Y-%m-%d\", date: \"$date\" } },\r\n                        totalPresent: { $sum: { $size: \"$records\" } },\r\n                        totalPossible: { $sum: { $size: \"$classInfo.students\" } }\r\n                    }\r\n                },\r\n                { $sort: { _id: 1 } }\r\n            ]);\r\n        } else {\r\n            // Safe approach: unwind then group to avoid $anyElementTrue crash on empty arrays\r\n            analytics = await Attendance.aggregate([\r\n                {\r\n                    $match: {\r\n                        date: { $gte: startDate },\r\n                        classId: { $in: classIds }\r\n                    }\r\n                },\r\n                {\r\n                    $group: {\r\n                        _id: { $dateToString: { format: \"%Y-%m-%d\", date: \"$date\" } },\r\n                        totalSessions: { $sum: 1 },\r\n                        allRecords: { $push: \"$records\" }\r\n                    }\r\n                },\r\n                { $sort: { _id: 1 } }\r\n            ]);\r\n\r\n            // Post-process in JS to safely count attended sessions\r\n            const studentId = req.user.id.toString();\r\n            analytics = analytics.map(day => {\r\n                let attended = 0;\r\n                day.allRecords.forEach(sessionRecords => {\r\n                    const wasPresent = sessionRecords.some(r =>\r\n                        r.student && r.student.toString() === studentId && r.status === 'present'\r\n                    );\r\n                    if (wasPresent) attended++;\r\n                });\r\n                return { _id: day._id, totalSessions: day.totalSessions, attendedSessions: attended };\r\n            });\r\n        }\r\n\r\n        const labels = [];\r\n        for (let i = historyDays - 1; i >= 0; i--) {\r\n            const date = new Date();\r\n            date.setDate(date.getDate() - i);\r\n            labels.push(date.toISOString().split('T')[0]);\r\n        }\r\n\r\n        // Calculate University Average for Comparison\r\n        const universityAvg = await Attendance.aggregate([\r\n            { $match: { date: { $gte: startDate } } },\r\n            {\r\n                $lookup: {\r\n                    from: 'classes',\r\n                    localField: 'classId',\r\n                    foreignField: '_id',\r\n                    as: 'classInfo'\r\n                }\r\n            },\r\n            { $unwind: '$classInfo' },\r\n            {\r\n                $group: {\r\n                    _id: { $dateToString: { format: \"%Y-%m-%d\", date: \"$date\" } },\r\n                    totalPresent: { $sum: { $size: \"$records\" } },\r\n                    totalPossible: { $sum: { $size: \"$classInfo.students\" } }\r\n                }\r\n            }\r\n        ]);\r\n\r\n        const data = labels.map(label => {\r\n            const found = analytics.find(a => a._id === label);\r\n            const foundUniv = universityAvg.find(u => u._id === label);\r\n\r\n            let value = 0;\r\n            if (req.user.role === 'professor') {\r\n                value = found ? Math.round((found.totalPresent / found.totalPossible) * 100) : 0;\r\n            } else {\r\n                value = found ? Math.round((found.attendedSessions / found.totalSessions) * 100) : 0;\r\n            }\r\n\r\n            const avgValue = foundUniv ? Math.round((foundUniv.totalPresent / foundUniv.totalPossible) * 100) : 0;\r\n            const volatility = Math.abs(value - avgValue);\r\n\r\n            return {\r\n                name: label.split('-').slice(1).join('/'),\r\n                value: value,\r\n                avg: avgValue,\r\n                volatility: volatility\r\n            };\r\n        });\r\n\r\n        res.json(data);\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   GET /api/classes/analytics/insights\r\n// @desc    Get actionable insights for professor/student\r\n// @access  Private\r\nrouter.get('/analytics/insights', auth, async (req, res) => {\r\n    try {\r\n        const insights = [];\r\n        if (req.user.role === 'professor') {\r\n            const classes = await Class.find({ professor: req.user.id });\r\n            const classIds = classes.map(c => c._id);\r\n\r\n            // 1. Identify \"At Risk\" Students (< 75% attendance)\r\n            const attendanceData = await Attendance.aggregate([\r\n                { $match: { classId: { $in: classIds } } },\r\n                { $unwind: \"$records\" },\r\n                {\r\n                    $group: {\r\n                        _id: \"$records.student\",\r\n                        presentCount: { $sum: { $cond: [{ $eq: [\"$records.status\", \"present\"] }, 1, 0] } },\r\n                        totalSessions: { $sum: 1 }\r\n                    }\r\n                }\r\n            ]);\r\n\r\n            const atRiskIds = attendanceData\r\n                .filter(a => (a.presentCount / a.totalSessions) < 0.75)\r\n                .map(a => a._id);\r\n\r\n            const atRiskStudents = await User.find({ _id: { $in: atRiskIds } }, 'name email universityRollNo');\r\n\r\n            if (atRiskStudents.length > 0) {\r\n                insights.push({\r\n                    type: 'warning',\r\n                    title: 'At-Risk Students',\r\n                    message: `${atRiskStudents.length} students have less than 75% attendance.`,\r\n                    data: atRiskStudents.slice(0, 5)\r\n                });\r\n            }\r\n\r\n            // 2. Best Attendance Class\r\n            const classParticipation = await Promise.all(classes.map(async (cls) => {\r\n                const sessions = await Attendance.find({ classId: cls._id });\r\n                if (sessions.length === 0) return { name: cls.subjectName || cls.name, rate: 0 };\r\n                const totalPossible = sessions.length * cls.students.length;\r\n                const totalPresent = sessions.reduce((acc, curr) => acc + curr.records.length, 0);\r\n                return { name: cls.subjectName || cls.name, rate: (totalPresent / totalPossible) * 100 };\r\n            }));\r\n\r\n            const bestClass = classParticipation.reduce((prev, current) => (prev.rate > current.rate) ? prev : current, { rate: -1 });\r\n            if (bestClass.rate > 0) {\r\n                insights.push({\r\n                    type: 'success',\r\n                    title: 'Top Performing Class',\r\n                    message: `${bestClass.name} has the highest engagement at ${bestClass.rate.toFixed(1)}%.`,\r\n                });\r\n            }\r\n\r\n        } else {\r\n            // Student Insights\r\n            const myAttendance = await Attendance.aggregate([\r\n                { $unwind: \"$records\" },\r\n                { $match: { \"records.student\": new mongoose.Types.ObjectId(req.user.id) } },\r\n                {\r\n                    $group: {\r\n                        _id: null,\r\n                        presentCount: { $sum: { $cond: [{ $eq: [\"$records.status\", \"present\"] }, 1, 0] } },\r\n                        totalSessions: { $sum: 1 }\r\n                    }\r\n                }\r\n            ]);\r\n\r\n            if (myAttendance.length > 0) {\r\n                const rate = (myAttendance[0].presentCount / myAttendance[0].totalSessions) * 100;\r\n                insights.push({\r\n                    type: rate >= 75 ? 'success' : 'warning',\r\n                    title: 'Global Attendance',\r\n                    message: `Your overall attendance across all classes is ${rate.toFixed(1)}%.`,\r\n                });\r\n\r\n                if (rate < 75) {\r\n                    insights.push({\r\n                        type: 'critical',\r\n                        title: 'Attendance Alert',\r\n                        message: 'You are below the minimum 75% requirement. Attend more sessions to avoid penalties.',\r\n                    });\r\n                } else {\r\n                    insights.push({\r\n                        type: 'info',\r\n                        title: 'Keep it Up!',\r\n                        message: 'Maintain your current trend to qualify for exams.',\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        res.json(insights);\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   GET /api/classes/analytics/radar\r\n// @desc    Get multi-dimensional engagement data\r\n// @access  Private\r\nrouter.get('/analytics/radar', auth, async (req, res) => {\r\n    try {\r\n        let classes;\r\n        if (req.user.role === 'professor') {\r\n            classes = await Class.find({ professor: req.user.id });\r\n        } else {\r\n            classes = await Class.find({ students: req.user.id });\r\n        }\r\n\r\n        const radarData = await Promise.all(classes.map(async (cls) => {\r\n            const sessions = await Attendance.find({ classId: cls._id });\r\n\r\n            let totalPresentCount = 0;\r\n            if (sessions.length > 0) {\r\n                totalPresentCount = sessions.reduce((acc, curr) => acc + curr.records.length, 0);\r\n            }\r\n\r\n            const consistency = sessions.length;\r\n            const enrollmentWeight = cls.students.length;\r\n\r\n            return {\r\n                subject: cls.subjectName || cls.name,\r\n                attendance: totalPresentCount,\r\n                consistency: consistency,\r\n                enrollment: enrollmentWeight\r\n            };\r\n        }));\r\n\r\n        res.json(radarData);\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   GET /api/classes/analytics/face-detection\r\n// @desc    Get mock face detection analysis for professor\r\n// @access  Private\r\nrouter.get('/analytics/face-detection', auth, async (req, res) => {\r\n    if (req.user.role !== 'professor') return res.status(403).json({ msg: 'Access denied' });\r\n    try {\r\n        const data = [\r\n            { name: 'Recognized', value: 78, fill: '#10b981' },\r\n            { name: 'Blurry', value: 12, fill: '#f59e0b' },\r\n            { name: 'Partial', value: 8, fill: '#ef4444' },\r\n            { name: 'Undetected', value: 2, fill: '#64748b' }\r\n        ];\r\n        res.json(data);\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   GET /api/classes/analytics/participation\r\n// @desc    Get subject-wise attendance (attended vs total classes per subject)\r\n// @access  Private\r\nrouter.get('/analytics/participation', auth, async (req, res) => {\r\n    try {\r\n        let classes;\r\n        if (req.user.role === 'professor') {\r\n            classes = await Class.find({ professor: req.user.id });\r\n        } else {\r\n            classes = await Class.find({ students: req.user.id });\r\n        }\r\n\r\n        const studentId = new mongoose.Types.ObjectId(req.user.id);\r\n\r\n        const participationData = await Promise.all(classes.map(async (cls) => {\r\n            const label = cls.subjectName || cls.name;\r\n            try {\r\n                const totalClasses = await Attendance.countDocuments({ classId: cls._id });\r\n                if (totalClasses === 0) return { name: label, totalClasses: 0, attended: 0, missed: 0 };\r\n\r\n                if (req.user.role === 'professor') {\r\n                    const allAttendance = await Attendance.find({ classId: cls._id });\r\n                    const totalPossible = allAttendance.length * cls.students.length;\r\n                    const totalPresent = allAttendance.reduce((acc, curr) =>\r\n                        acc + curr.records.filter(r => r.status === 'present').length, 0);\r\n                    const missed = totalPossible - totalPresent;\r\n                    return { name: label, totalClasses: totalPossible, attended: totalPresent, missed };\r\n                } else {\r\n                    // Student: use $elemMatch so BOTH student and status apply to the SAME record\r\n                    const attended = await Attendance.countDocuments({\r\n                        classId: cls._id,\r\n                        records: {\r\n                            $elemMatch: {\r\n                                student: studentId,\r\n                                status: 'present'\r\n                            }\r\n                        }\r\n                    });\r\n                    const missed = totalClasses - attended;\r\n                    return { name: label, totalClasses, attended, missed };\r\n                }\r\n            } catch (innerErr) {\r\n                console.error(`Participation error for class ${cls.name}:`, innerErr);\r\n                return { name: label, totalClasses: 0, attended: 0, missed: 0 };\r\n            }\r\n        }));\r\n\r\n        res.json(participationData);\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   GET /api/classes/summary\r\n// @desc    Get dashboard summary stats\r\n// @access  Private\r\nrouter.get('/summary', auth, async (req, res) => {\r\n    try {\r\n        const last7Days = new Date();\r\n        last7Days.setDate(last7Days.getDate() - 7);\r\n        const prev7Days = new Date();\r\n        prev7Days.setDate(prev7Days.getDate() - 14);\r\n\r\n        if (req.user.role === 'professor') {\r\n            const classes = await Class.find({ professor: req.user.id });\r\n            const classIds = classes.map(c => c._id);\r\n            const allStudents = classes.reduce((acc, curr) => acc.concat(curr.students), []);\r\n            const uniqueStudentsCount = new Set(allStudents.map(s => s.toString())).size;\r\n\r\n            const attendanceCurrent = await Attendance.find({ classId: { $in: classIds }, date: { $gte: last7Days } });\r\n            const attendancePrev = await Attendance.find({ classId: { $in: classIds }, date: { $gte: prev7Days, $lt: last7Days } });\r\n\r\n            const calcAvg = (records) => {\r\n                if (records.length === 0) return 0;\r\n                let totalPresent = 0;\r\n                let totalPossible = 0;\r\n                records.forEach(r => {\r\n                    totalPresent += r.records.filter(rec => rec.status === 'present').length;\r\n                    totalPossible += r.records.length;\r\n                });\r\n                return totalPossible === 0 ? 0 : (totalPresent / totalPossible) * 100;\r\n            };\r\n\r\n            const currentAvg = calcAvg(attendanceCurrent);\r\n            const prevAvg = calcAvg(attendancePrev);\r\n            const trend = prevAvg === 0 ? 0 : ((currentAvg - prevAvg) / prevAvg) * 100;\r\n\r\n            res.json({\r\n                primaryStat: uniqueStudentsCount,\r\n                avgAttendance: currentAvg.toFixed(1),\r\n                trend: trend.toFixed(1)\r\n            });\r\n        } else {\r\n            const classes = await Class.find({ students: req.user.id });\r\n            const classIds = classes.map(c => c._id);\r\n\r\n            const attendanceCurrent = await Attendance.find({ classId: { $in: classIds }, date: { $gte: last7Days } });\r\n            const attendancePrev = await Attendance.find({ classId: { $in: classIds }, date: { $gte: prev7Days, $lt: last7Days } });\r\n\r\n            const calcStudentStats = (records) => {\r\n                const myRecords = records.filter(r => r.records.some(rec => rec.student.toString() === req.user.id));\r\n                const presentCount = myRecords.filter(r => r.records.find(rec => rec.student.toString() === req.user.id && rec.status === 'present')).length;\r\n                return presentCount;\r\n            };\r\n\r\n            const currentCount = calcStudentStats(attendanceCurrent);\r\n            const prevCount = calcStudentStats(attendancePrev);\r\n            const trend = currentCount - prevCount;\r\n\r\n            // Calculate overall percentage for the progress bar (strictly using total classes happened)\r\n            const totalClassHappened = await Attendance.countDocuments({ classId: { $in: classIds } });\r\n            const presentMySessions = await Attendance.countDocuments({\r\n                classId: { $in: classIds },\r\n                \"records.student\": req.user.id,\r\n                \"records.status\": \"present\"\r\n            });\r\n            const globalRate = totalClassHappened === 0 ? 0 : Math.round((presentMySessions / totalClassHappened) * 100);\r\n\r\n            // Calculate classes needed to reach 75%\r\n            // (Present + x) / (Total + x) >= 0.75 => x >= (0.75 * Total - Present) / 0.25\r\n            let message = \"You're in the safe zone!\";\r\n            if (globalRate < 75) {\r\n                const x = Math.ceil((0.75 * totalClassHappened - presentMySessions) / 0.25);\r\n                message = `You need to attend ${x} more classes to stay above 75%.`;\r\n            }\r\n\r\n            res.json({\r\n                primaryStat: globalRate,\r\n                avgAttendance: globalRate,\r\n                trend: trend,\r\n                statusMessage: message\r\n            });\r\n        }\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// --- CLASS ACTIONS ---\r\n\r\n// Create Class (Prof)\r\nrouter.post('/create', auth, async (req, res) => {\r\n    if (req.user.role !== 'professor') return res.status(403).json({ msg: 'Access denied' });\r\n\r\n    const { name, code, subjectName } = req.body;\r\n    try {\r\n        let newClass = new Class({\r\n            name,\r\n            subjectName: subjectName || name,\r\n            code,\r\n            professor: req.user.id,\r\n            institutionId: req.user.institutionId\r\n        });\r\n        await newClass.save();\r\n        await logAction('CREATE_CLASS', req.user, newClass.name, { code, subjectName: newClass.subjectName });\r\n        res.json(newClass);\r\n    } catch (err) {\r\n        res.status(500).send('Server Error: ' + err.message);\r\n    }\r\n});\r\n\r\n// Join Class (Student)\r\nrouter.post('/join', auth, async (req, res) => {\r\n    const { code } = req.body;\r\n    try {\r\n        const classroom = await Class.findOne({ code });\r\n        if (!classroom) return res.status(404).json({ msg: 'Class not found' });\r\n\r\n        // Prevent duplicates\r\n        if (classroom.students.includes(req.user.id)) {\r\n            return res.status(400).json({ msg: 'Already joined' });\r\n        }\r\n\r\n        classroom.students.push(req.user.id);\r\n        await classroom.save();\r\n        await logAction('JOIN_CLASS', req.user, classroom.name, { code });\r\n\r\n        // Notification for Student\r\n        const studentNotification = new Notification({\r\n            recipient: req.user.id,\r\n            title: 'Class Joined',\r\n            message: `You have successfully joined ${classroom.name}.`,\r\n            type: 'class',\r\n            link: `/classroom/${classroom.code}`\r\n        });\r\n        await studentNotification.save();\r\n\r\n        // Notification for Professor\r\n        const professorNotification = new Notification({\r\n            recipient: classroom.professor,\r\n            title: 'New Student Joined',\r\n            message: `${req.user.name} has joined your class: ${classroom.name}.`,\r\n            type: 'class',\r\n            link: `/classroom/${classroom.code}`\r\n        });\r\n        await professorNotification.save();\r\n\r\n        res.json({ msg: 'Joined successfully' });\r\n    } catch (err) {\r\n        res.status(500).send('Server Error: ' + err.message);\r\n    }\r\n});\r\n\r\n// Leave Class (Student)\r\nrouter.post('/:id/leave', auth, async (req, res) => {\r\n    try {\r\n        const classroom = await Class.findById(req.params.id);\r\n        if (!classroom) return res.status(404).json({ msg: 'Class not found' });\r\n\r\n        classroom.students = classroom.students.filter(id => id.toString() !== req.user.id);\r\n        await classroom.save();\r\n\r\n        await logAction('LEAVE_CLASS', req.user, classroom.name);\r\n        res.json({ msg: 'Left class successfully' });\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// Delete Class (Professor)\r\nrouter.delete('/:id', auth, async (req, res) => {\r\n    if (req.user.role !== 'professor') return res.status(403).json({ msg: 'Access denied' });\r\n\r\n    try {\r\n        const classroom = await Class.findById(req.params.id);\r\n        if (!classroom) return res.status(404).json({ msg: 'Class not found' });\r\n\r\n        if (classroom.professor.toString() !== req.user.id) {\r\n            return res.status(401).json({ msg: 'Unauthorized' });\r\n        }\r\n\r\n        await Attendance.deleteMany({ classId: req.params.id });\r\n        await Class.findByIdAndDelete(req.params.id);\r\n\r\n        await logAction('DELETE_CLASS', req.user, classroom.name);\r\n        res.json({ msg: 'Class deleted successfully' });\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// Get My Classes\r\nrouter.get('/my', auth, async (req, res) => {\r\n    try {\r\n        let classes;\r\n        if (req.user.role === 'professor') {\r\n            classes = await Class.find({ professor: req.user.id });\r\n        } else {\r\n            classes = await Class.find({ students: req.user.id });\r\n        }\r\n        res.json(classes);\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// Save Face Descriptor\r\nrouter.post('/face/register', auth, async (req, res) => {\r\n    const { descriptor } = req.body;\r\n    try {\r\n        const user = await User.findById(req.user.id);\r\n        user.faceDescriptor = descriptor;\r\n        user.isFaceRegistered = true;\r\n        await user.save();\r\n        res.json({ msg: 'Face registered' });\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// Get Class Students (For Attendance)\r\nrouter.get('/:classCode/students', auth, async (req, res) => {\r\n    try {\r\n        const classroom = await Class.findOne({ code: req.params.classCode }).populate('students', 'name faceDescriptor isFaceRegistered universityRollNo classRollNo profilePic');\r\n        if (!classroom) return res.status(404).json({ msg: 'Class not found' });\r\n\r\n        res.json(classroom.students);\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// Mark Attendance\r\nrouter.post('/mark', auth, async (req, res) => {\r\n    const { classCode, studentsPresent } = req.body;\r\n\r\n    try {\r\n        const classroom = await Class.findOne({ code: classCode });\r\n        if (!classroom) return res.status(404).json({ msg: 'Class not found' });\r\n\r\n        let attendance = new Attendance({\r\n            classId: classroom.id,\r\n            records: studentsPresent.map(id => ({\r\n                student: id,\r\n                status: 'present'\r\n            }))\r\n        });\r\n\r\n        // Geo-Fencing Check\r\n        if (req.body.location && classroom.location && classroom.location.lat) {\r\n            const { lat, long } = req.body.location;\r\n            const classLat = classroom.location.lat;\r\n            const classLong = classroom.location.long;\r\n\r\n            const R = 6371e3;\r\n            const 1 = lat * Math.PI / 180;\r\n            const 2 = classLat * Math.PI / 180;\r\n            const  = (classLat - lat) * Math.PI / 180;\r\n            const  = (classLong - long) * Math.PI / 180;\r\n\r\n            const a = Math.sin( / 2) * Math.sin( / 2) +\r\n                Math.cos(1) * Math.cos(2) *\r\n                Math.sin( / 2) * Math.sin( / 2);\r\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n            const d = R * c;\r\n\r\n            if (d > classroom.location.radius) {\r\n                return res.status(400).json({ msg: `You are ${Math.round(d)}m away. Must be within ${classroom.location.radius}m.` });\r\n            }\r\n        }\r\n\r\n        await attendance.save();\r\n        await logAction('MARK_ATTENDANCE', req.user, classroom.name, { count: studentsPresent.length });\r\n\r\n        // Notifications for Students\r\n        const attendancePromises = classroom.students.map(async studentId => {\r\n            const isPresent = studentsPresent.includes(studentId.toString());\r\n            const notification = new Notification({\r\n                recipient: studentId,\r\n                title: isPresent ? 'Attendance Marked: Present' : 'Attendance Marked: Absent',\r\n                message: isPresent\r\n                    ? `You were marked Present in ${classroom.name} today.`\r\n                    : `You were marked Absent in ${classroom.name} today.`,\r\n                type: isPresent ? 'attendance' : 'absence',\r\n                link: `/classroom/${classroom.code}`\r\n            });\r\n            return notification.save();\r\n        });\r\n        await Promise.all(attendancePromises);\r\n\r\n        // Low Attendance Alerts (10% random trigger for demo)\r\n        studentsPresent.forEach(async studentId => {\r\n            if (Math.random() < 0.1) {\r\n                const student = await User.findById(studentId);\r\n                if (student && student.email) {\r\n                    transporter.sendMail({\r\n                        from: 'admin@smartclass.com',\r\n                        to: student.email,\r\n                        subject: `Low Attendance Warning: ${classroom.name}`,\r\n                        text: `Your attendance in ${classroom.name} has dropped below ${classroom.minAttendance}%. Please attend upcoming classes.`\r\n                    }).catch(err => console.error(\"Email failed\", err));\r\n                }\r\n            }\r\n        });\r\n\r\n        res.json({ msg: 'Attendance marked' });\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// Get Attendance History\r\nrouter.get('/:classCode/attendance', auth, async (req, res) => {\r\n    try {\r\n        const classroom = await Class.findOne({ code: req.params.classCode });\r\n        if (!classroom) return res.status(404).json({ msg: 'Class not found' });\r\n\r\n        let query = { classId: classroom._id };\r\n\r\n        // If student, only show TODAY'S attendance sessions\r\n        if (req.user.role === 'student') {\r\n            const start = new Date();\r\n            start.setHours(0, 0, 0, 0);\r\n            const end = new Date();\r\n            end.setHours(23, 59, 59, 999);\r\n            query.date = { $gte: start, $lte: end };\r\n        }\r\n\r\n        let history = await Attendance.find(query)\r\n            .populate('records.student', 'name email rollNo')\r\n            .sort({ date: -1 });\r\n\r\n        // If student, filter records to show only THEIR OWN status\r\n        if (req.user.role === 'student') {\r\n            history = history.map(session => {\r\n                const studentRecord = session.records.filter(r =>\r\n                    r.student && r.student._id.toString() === req.user.id\r\n                );\r\n                return {\r\n                    ...session.toObject(),\r\n                    records: studentRecord\r\n                };\r\n            });\r\n        }\r\n\r\n        res.json(history);\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   POST /api/classes/:classCode/announcements\r\nrouter.post('/:classCode/announcements', auth, async (req, res) => {\r\n    const { text } = req.body;\r\n    try {\r\n        const classroom = await Class.findOne({ code: req.params.classCode });\r\n        if (!classroom) return res.status(404).json({ msg: 'Class not found' });\r\n        if (classroom.professor.toString() !== req.user.id) return res.status(403).json({ msg: 'Not authorized' });\r\n\r\n        classroom.announcements.unshift({ text, author: req.user.id });\r\n        await classroom.save();\r\n\r\n        const notificationPromises = classroom.students.map(studentId => {\r\n            const notification = new Notification({\r\n                recipient: studentId,\r\n                title: 'New Announcement',\r\n                message: `Prof. ${req.user.name} posted an update in ${classroom.name}.`,\r\n                type: 'update',\r\n                link: `/classroom/${classroom.code}`\r\n            });\r\n            return notification.save();\r\n        });\r\n        await Promise.all(notificationPromises);\r\n\r\n        res.json(classroom.announcements[0]);\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   POST /api/classes/:classCode/assignments\r\nrouter.post('/:classCode/assignments', auth, async (req, res) => {\r\n    const { title, dueDate } = req.body;\r\n    try {\r\n        const classroom = await Class.findOne({ code: req.params.classCode });\r\n        if (!classroom) return res.status(404).json({ msg: 'Class not found' });\r\n        if (classroom.professor.toString() !== req.user.id) return res.status(403).json({ msg: 'Not authorized' });\r\n\r\n        classroom.assignments.unshift({ title, dueDate });\r\n        await classroom.save();\r\n\r\n        const notificationPromises = classroom.students.map(studentId => {\r\n            const notification = new Notification({\r\n                recipient: studentId,\r\n                title: 'New Assignment',\r\n                message: `New assignment: ${title} in ${classroom.name}. Due: ${new Date(dueDate).toLocaleDateString()}`,\r\n                type: 'assignment',\r\n                link: `/classroom/${classroom.code}`\r\n            });\r\n            return notification.save();\r\n        });\r\n        await Promise.all(notificationPromises);\r\n\r\n        res.json(classroom.assignments[0]);\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   POST /api/classes/:classCode/notes\r\nrouter.post('/:classCode/notes', auth, async (req, res) => {\r\n    const { title, link } = req.body;\r\n    try {\r\n        const classroom = await Class.findOne({ code: req.params.classCode });\r\n        if (!classroom) return res.status(404).json({ msg: 'Class not found' });\r\n        if (classroom.professor.toString() !== req.user.id) return res.status(403).json({ msg: 'Not authorized' });\r\n\r\n        classroom.notes.unshift({ title, link });\r\n        await classroom.save();\r\n\r\n        const notificationPromises = classroom.students.map(studentId => {\r\n            const notification = new Notification({\r\n                recipient: studentId,\r\n                title: 'New Study Material',\r\n                message: `New notes: ${title} uploaded in ${classroom.name}.`,\r\n                type: 'note',\r\n                link: `/classroom/${classroom.code}`\r\n            });\r\n            return notification.save();\r\n        });\r\n        await Promise.all(notificationPromises);\r\n\r\n        res.json(classroom.notes[0]);\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\nmodule.exports = router;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\routes\\institution.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":3,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":3,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":4,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":4,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":5,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":5,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":6,"column":16,"nodeType":"Identifier","messageId":"undef","endLine":6,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":14,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":14,"endColumn":50},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":20,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":17},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":82,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":82,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":87,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":87,"endColumn":7}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const express = require('express');\r\nconst router = express.Router();\r\nconst Institution = require('../models/Institution');\r\nconst User = require('../models/User');\r\nconst jwt = require('jsonwebtoken');\r\nconst bcrypt = require('bcryptjs');\r\n\r\n// Middleware: Check for Super Admin\r\nconst isSuperAdmin = (req, res, next) => {\r\n    const token = req.header('x-auth-token');\r\n    if (!token) return res.status(401).json({ msg: 'No token' });\r\n\r\n    try {\r\n        const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n        if (decoded.user.role !== 'super_admin') {\r\n            return res.status(403).json({ msg: 'Super Admin access required' });\r\n        }\r\n        req.user = decoded.user;\r\n        next();\r\n    } catch (err) {\r\n        res.status(401).json({ msg: 'Token invalid' });\r\n    }\r\n};\r\n\r\n// @route   POST /api/institutions/create\r\n// @desc    Create a new Institution\r\n// @access  Super Admin\r\nrouter.post('/create', isSuperAdmin, async (req, res) => {\r\n    const { name, code, address } = req.body;\r\n    try {\r\n        let institution = await Institution.findOne({ code });\r\n        if (institution) return res.status(400).json({ msg: 'Institution code already exists' });\r\n\r\n        institution = new Institution({ name, code, address });\r\n        await institution.save();\r\n        res.json(institution);\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   POST /api/institutions/add-admin\r\n// @desc    Create/Assign a College Admin\r\n// @access  Super Admin\r\nrouter.post('/add-admin', isSuperAdmin, async (req, res) => {\r\n    const { name, email, password, institutionId } = req.body;\r\n    try {\r\n        let user = await User.findOne({ email });\r\n        if (user) return res.status(400).json({ msg: 'User already exists' });\r\n\r\n        const salt = await bcrypt.genSalt(10);\r\n        const hashedPassword = await bcrypt.hash(password, salt);\r\n\r\n        user = new User({\r\n            name,\r\n            email,\r\n            password: hashedPassword,\r\n            role: 'college_admin',\r\n            institutionId\r\n        });\r\n\r\n        await user.save();\r\n\r\n        // Link admin to institution\r\n        await Institution.findByIdAndUpdate(institutionId, { adminId: user._id });\r\n\r\n        res.json({ msg: 'College Admin created', user });\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   GET /api/institutions/all\r\n// @desc    Get all institutions\r\n// @access  Public (for registration dropdown) or Super Admin\r\nrouter.get('/all', async (req, res) => {\r\n    try {\r\n        const institutions = await Institution.find().select('name code _id');\r\n        res.json(institutions);\r\n    } catch (err) {\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\nmodule.exports = router;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\routes\\logs.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":3,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":3,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":4,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":4,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":12,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":12,"endColumn":50},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":18,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":47,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":47,"endColumn":7}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const express = require('express');\r\nconst router = express.Router();\r\nconst AuditLog = require('../models/AuditLog');\r\nconst jwt = require('jsonwebtoken');\r\n\r\n// Middleware to check for Admin/Super Admin\r\nconst isAdmin = (req, res, next) => {\r\n    const token = req.header('x-auth-token');\r\n    if (!token) return res.status(401).json({ msg: 'No token' });\r\n\r\n    try {\r\n        const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n        if (decoded.user.role !== 'admin' && decoded.user.role !== 'super_admin' && decoded.user.role !== 'college_admin') {\r\n            return res.status(403).json({ msg: 'Access denied' });\r\n        }\r\n        req.user = decoded.user;\r\n        next();\r\n    } catch (e) {\r\n        res.status(401).json({ msg: 'Token invalid' });\r\n    }\r\n};\r\n\r\n// @route   GET /api/logs\r\n// @desc    Get Audit Logs\r\n// @access  Admin/Super Admin/College Admin\r\nrouter.get('/', isAdmin, async (req, res) => {\r\n    try {\r\n        let query = {};\r\n\r\n        // precise filtering based on role\r\n        if (req.user.role === 'college_admin') {\r\n            query.institutionId = req.user.institutionId;\r\n        }\r\n\r\n        const logs = await AuditLog.find(query)\r\n            .populate('performedBy', 'name email role')\r\n            .sort({ timestamp: -1 })\r\n            .limit(100);\r\n\r\n        res.json(logs);\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\nmodule.exports = router;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\routes\\notifications.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":3,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":3,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":4,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":4,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":11,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":11,"endColumn":50},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":14,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":92,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":92,"endColumn":7}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const express = require('express');\r\nconst router = express.Router();\r\nconst Notification = require('../models/Notification.js');\r\nconst jwt = require('jsonwebtoken');\r\n\r\n// Middleware to check token\r\nconst auth = (req, res, next) => {\r\n    const token = req.header('x-auth-token');\r\n    if (!token) return res.status(401).json({ msg: 'No token' });\r\n    try {\r\n        const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n        req.user = decoded.user;\r\n        next();\r\n    } catch (e) {\r\n        res.status(401).json({ msg: 'Token invalid' });\r\n    }\r\n};\r\n\r\n// @route   GET /api/notifications\r\n// @desc    Get all notifications for current user\r\n// @access  Private\r\nrouter.get('/', auth, async (req, res) => {\r\n    try {\r\n        const notifications = await Notification.find({ recipient: req.user.id })\r\n            .sort({ createdAt: -1 })\r\n            .limit(50);\r\n        res.json(notifications);\r\n    } catch (err) {\r\n        console.error(err.message);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   PUT /api/notifications/:id/read\r\n// @desc    Mark a notification as read\r\n// @access  Private\r\nrouter.put('/:id/read', auth, async (req, res) => {\r\n    try {\r\n        const notification = await Notification.findById(req.params.id);\r\n        if (!notification) return res.status(404).json({ msg: 'Notification not found' });\r\n\r\n        // Check user\r\n        if (notification.recipient.toString() !== req.user.id) {\r\n            return res.status(401).json({ msg: 'User not authorized' });\r\n        }\r\n\r\n        notification.isRead = true;\r\n        await notification.save();\r\n        res.json(notification);\r\n    } catch (err) {\r\n        console.error(err.message);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   PUT /api/notifications/read-all\r\n// @desc    Mark all notifications as read\r\n// @access  Private\r\nrouter.put('/read-all', auth, async (req, res) => {\r\n    try {\r\n        await Notification.updateMany(\r\n            { recipient: req.user.id, isRead: false },\r\n            { $set: { isRead: true } }\r\n        );\r\n        res.json({ msg: 'All notifications marked as read' });\r\n    } catch (err) {\r\n        console.error(err.message);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   DELETE /api/notifications/:id\r\n// @desc    Delete a notification\r\n// @access  Private\r\nrouter.delete('/:id', auth, async (req, res) => {\r\n    try {\r\n        const notification = await Notification.findById(req.params.id);\r\n        if (!notification) return res.status(404).json({ msg: 'Notification not found' });\r\n\r\n        if (notification.recipient.toString() !== req.user.id) {\r\n            return res.status(401).json({ msg: 'User not authorized' });\r\n        }\r\n\r\n        await Notification.findByIdAndDelete(req.params.id);\r\n        res.json({ msg: 'Notification removed' });\r\n    } catch (err) {\r\n        console.error(err.message);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\nmodule.exports = router;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\routes\\users.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":3,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":3,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":4,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":4,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":11,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":11,"endColumn":50},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":14,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":87,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":87,"endColumn":7}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const express = require('express');\r\nconst router = express.Router();\r\nconst User = require('../models/User.js');\r\nconst jwt = require('jsonwebtoken');\r\n\r\n// Middleware to check token\r\nconst auth = (req, res, next) => {\r\n    const token = req.header('x-auth-token');\r\n    if (!token) return res.status(401).json({ msg: 'No token' });\r\n    try {\r\n        const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n        req.user = decoded.user;\r\n        next();\r\n    } catch (e) {\r\n        res.status(401).json({ msg: 'Token invalid' });\r\n    }\r\n};\r\n\r\n// @route   GET /api/users/profile\r\n// @desc    Get current user's profile\r\n// @access  Private\r\nrouter.get('/profile', auth, async (req, res) => {\r\n    try {\r\n        const user = await User.findById(req.user.id).select('-password').populate('institutionId', 'name');\r\n        res.json(user);\r\n    } catch (err) {\r\n        console.error(err.message);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   PUT /api/users/profile\r\n// @desc    Update current user's profile\r\n// @access  Private\r\nrouter.put('/profile', auth, async (req, res) => {\r\n    const { name, email, universityRollNo, classRollNo, profilePic } = req.body;\r\n\r\n    // Build profile object\r\n    const profileFields = {};\r\n    if (name) profileFields.name = name;\r\n    if (email) profileFields.email = email;\r\n    if (universityRollNo) profileFields.universityRollNo = universityRollNo;\r\n    if (classRollNo) profileFields.classRollNo = classRollNo;\r\n    if (profilePic) profileFields.profilePic = profilePic;\r\n\r\n    try {\r\n        let user = await User.findById(req.user.id);\r\n        if (!user) return res.status(404).json({ msg: 'User not found' });\r\n\r\n        user = await User.findByIdAndUpdate(\r\n            req.user.id,\r\n            { $set: profileFields },\r\n            { new: true }\r\n        ).select('-password');\r\n\r\n        res.json(user);\r\n    } catch (err) {\r\n        console.error(err.message);\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\n// @route   GET /api/users/:id\r\n// @desc    Get user profile by ID (for professors/admins)\r\n// @access  Private\r\nrouter.get('/:id', auth, async (req, res) => {\r\n    try {\r\n        // Only professors and admins can access other users' profiles\r\n        if (req.user.role !== 'professor' && req.user.role !== 'college_admin' && req.user.role !== 'super_admin') {\r\n            // Students can only see their own profile via this route too, or just block it\r\n            if (req.user.id !== req.params.id) {\r\n                return res.status(403).json({ msg: 'Access denied' });\r\n            }\r\n        }\r\n\r\n        const user = await User.findById(req.params.id).select('-password');\r\n        if (!user) return res.status(404).json({ msg: 'User not found' });\r\n\r\n        res.json(user);\r\n    } catch (err) {\r\n        console.error(err.message);\r\n        if (err.kind === 'ObjectId') return res.status(404).json({ msg: 'User not found' });\r\n        res.status(500).send('Server Error');\r\n    }\r\n});\r\n\r\nmodule.exports = router;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\server\\utils\\logger.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":1,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'module' is not defined.","line":19,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":19,"endColumn":7}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const AuditLog = require('../models/AuditLog');\r\n\r\nconst logAction = async (action, user, target, details = {}) => {\r\n    try {\r\n        const log = new AuditLog({\r\n            action,\r\n            performedBy: user.id,\r\n            institutionId: user.institutionId,\r\n            target,\r\n            details\r\n        });\r\n        await log.save();\r\n        console.log(`[AUDIT] ${action} by ${user.name} on ${target}`);\r\n    } catch (err) {\r\n        console.error(\"Failed to create audit log:\", err);\r\n    }\r\n};\r\n\r\nmodule.exports = logAction;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\App.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\components\\AnalyticsCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\components\\ErrorBoundary.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":9,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":42,"suggestions":[{"messageId":"removeVar","data":{"varName":"error"},"fix":{"range":[244,249],"text":""},"desc":"Remove unused variable 'error'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n\r\nclass ErrorBoundary extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { hasError: false, error: null, errorInfo: null };\r\n    }\r\n\r\n    static getDerivedStateFromError(error) {\r\n        return { hasError: true };\r\n    }\r\n\r\n    componentDidCatch(error, errorInfo) {\r\n        console.error(\"Uncaught Error:\", error, errorInfo);\r\n        this.setState({ error, errorInfo });\r\n    }\r\n\r\n    render() {\r\n        if (this.state.hasError) {\r\n            return (\r\n                <div style={{ padding: '50px', textAlign: 'center', color: 'white' }}>\r\n                    <h1>Something went wrong.</h1>\r\n                    <details style={{ whiteSpace: 'pre-wrap', marginTop: '20px', textAlign: 'left', background: 'rgba(0,0,0,0.5)', padding: '20px' }}>\r\n                        {this.state.error && this.state.error.toString()}\r\n                        <br />\r\n                        {this.state.errorInfo && this.state.errorInfo.componentStack}\r\n                    </details>\r\n                    <button\r\n                        onClick={() => window.location.href = '/dashboard'}\r\n                        style={{ marginTop: '20px', padding: '10px 20px', cursor: 'pointer' }}\r\n                    >\r\n                        Reload Dashboard\r\n                    </button>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return this.props.children;\r\n    }\r\n}\r\n\r\nexport default ErrorBoundary;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\components\\Layout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\components\\Navbar.jsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`fetchNotifications` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\n  13 |     useEffect(() => {\n  14 |         if (user) {\n> 15 |             fetchNotifications();\n     |             ^^^^^^^^^^^^^^^^^^ `fetchNotifications` accessed before it is declared\n  16 |             const interval = setInterval(fetchNotifications, 30000); // Poll every 30s\n  17 |             return () => clearInterval(interval);\n  18 |         }\n\n  29 |     }, []);\n  30 |\n> 31 |     const fetchNotifications = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 32 |         try {\n     | ^^^^^^^^^^^^^\n> 33 |             const res = await api.get('/notifications');\n     | ^^^^^^^^^^^^^\n> 34 |             setNotifications(res.data);\n     | ^^^^^^^^^^^^^\n> 35 |         } catch (err) {\n     | ^^^^^^^^^^^^^\n> 36 |             console.error('Error fetching notifications:', err);\n     | ^^^^^^^^^^^^^\n> 37 |         }\n     | ^^^^^^^^^^^^^\n> 38 |     };\n     | ^^^^^^^ `fetchNotifications` is declared here\n  39 |\n  40 |     const markAsRead = async (id) => {\n  41 |         try {","line":15,"column":13,"nodeType":null,"endLine":15,"endColumn":31},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchNotifications'. Either include it or remove the dependency array.","line":19,"column":8,"nodeType":"ArrayExpression","endLine":19,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNotifications, user]","fix":{"range":[821,827],"text":"[fetchNotifications, user]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { GraduationCap, LogOut, Bell, User as UserIcon, Calendar, BookOpen, Shield, CheckCircle, Info, AlertCircle, X } from 'lucide-react';\r\n\r\nconst Navbar = () => {\r\n    const { user, logout, api } = useAuth();\r\n    const navigate = useNavigate();\r\n    const [notifications, setNotifications] = useState([]);\r\n    const [showNotifications, setShowNotifications] = useState(false);\r\n    const dropdownRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            fetchNotifications();\r\n            const interval = setInterval(fetchNotifications, 30000); // Poll every 30s\r\n            return () => clearInterval(interval);\r\n        }\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        const handleClickOutside = (event) => {\r\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\r\n                setShowNotifications(false);\r\n            }\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    const fetchNotifications = async () => {\r\n        try {\r\n            const res = await api.get('/notifications');\r\n            setNotifications(res.data);\r\n        } catch (err) {\r\n            console.error('Error fetching notifications:', err);\r\n        }\r\n    };\r\n\r\n    const markAsRead = async (id) => {\r\n        try {\r\n            await api.put(`/notifications/${id}/read`);\r\n            setNotifications(notifications.map(n => n._id === id ? { ...n, isRead: true } : n));\r\n        } catch (err) {\r\n            console.error('Error marking read:', err);\r\n        }\r\n    };\r\n\r\n    const markAllRead = async () => {\r\n        try {\r\n            await api.put('/notifications/read-all');\r\n            setNotifications(notifications.map(n => ({ ...n, isRead: true })));\r\n        } catch (err) {\r\n            console.error('Error marking all read:', err);\r\n        }\r\n    };\r\n\r\n    const handleLogout = () => {\r\n        logout();\r\n        navigate('/login');\r\n    };\r\n\r\n    const unreadCount = notifications.filter(n => !n.isRead).length;\r\n\r\n    const getIcon = (type) => {\r\n        switch (type) {\r\n            case 'attendance': return <CheckCircle size={14} className=\"text-success\" />;\r\n            case 'absence': return <AlertCircle size={14} className=\"text-critical\" />;\r\n            case 'class': return <BookOpen size={14} className=\"text-warning\" />;\r\n            default: return <Info size={14} className=\"text-primary\" />;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <nav className=\"glass-panel\" style={{\r\n            position: 'fixed',\r\n            top: '20px',\r\n            left: '50%',\r\n            transform: 'translateX(-50%)',\r\n            width: '95%',\r\n            maxWidth: '1200px',\r\n            zIndex: 1000,\r\n            padding: '12px 30px',\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            borderRadius: '50px'\r\n        }}>\r\n            <Link to=\"/dashboard\" style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\r\n                <div style={{\r\n                    width: '35px',\r\n                    height: '35px',\r\n                    background: 'linear-gradient(45deg, var(--accent-primary), var(--accent-secondary))',\r\n                    borderRadius: '10px',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    boxShadow: '0 0 15px var(--accent-glow)'\r\n                }}>\r\n                    <GraduationCap size={20} color=\"white\" />\r\n                </div>\r\n                <h2 className=\"text-gradient\" style={{ fontSize: '1.4rem', margin: 0, fontWeight: '800' }}>Smart Attendance</h2>\r\n            </Link>\r\n\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>\r\n                {/* Admin Link */}\r\n                {user?.role === 'admin' && (\r\n                    <Link to=\"/admin\" style={{\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        gap: '8px',\r\n                        color: 'var(--accent-secondary)',\r\n                        fontSize: '0.9rem',\r\n                        fontWeight: 'bold',\r\n                        marginRight: '10px'\r\n                    }}>\r\n                        <Shield size={18} /> Admin\r\n                    </Link>\r\n                )}\r\n\r\n                {/* Notification Bell */}\r\n                <div ref={dropdownRef} style={{ position: 'relative' }}>\r\n                    <div\r\n                        onClick={() => setShowNotifications(!showNotifications)}\r\n                        style={{ position: 'relative', cursor: 'pointer', padding: '8px', borderRadius: '50%', background: 'rgba(255,255,255,0.05)' }}\r\n                    >\r\n                        <Bell size={18} />\r\n                        {unreadCount > 0 && (\r\n                            <div style={{\r\n                                position: 'absolute', top: '5px', right: '5px',\r\n                                width: '12px', height: '12px', background: 'var(--accent-secondary)',\r\n                                borderRadius: '50%', border: '2px solid var(--bg-gradient-mid)',\r\n                                fontSize: '8px', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: 'bold'\r\n                            }}>\r\n                                {unreadCount > 9 ? '9+' : unreadCount}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {showNotifications && (\r\n                        <div\r\n                            ref={dropdownRef}\r\n                            style={{\r\n                                position: 'absolute', top: '100%', right: '0', marginTop: '15px',\r\n                                width: '380px', background: '#0f172a', border: '1px solid #1e293b',\r\n                                borderRadius: '20px', boxShadow: '0 20px 50px rgba(0,0,0,0.5)',\r\n                                padding: '20px', zIndex: '1000'\r\n                            }}\r\n                            className=\"fade-in\"\r\n                        >\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px' }}>\r\n                                <h3 style={{ margin: 0, fontSize: '1.1rem', color: 'white' }}>Notifications</h3>\r\n                                {notifications.filter(n => !n.isRead).length > 0 && (\r\n                                    <button\r\n                                        onClick={markAllRead}\r\n                                        style={{ background: 'none', border: 'none', color: 'var(--accent-primary)', cursor: 'pointer', fontSize: '0.8rem', fontWeight: 'bold' }}\r\n                                    >\r\n                                        Mark all read\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div style={{ maxHeight: '400px', overflowY: 'auto', marginBottom: '15px', paddingRight: '5px' }}>\r\n                                {notifications.length === 0 ? (\r\n                                    <div style={{ textAlign: 'center', padding: '30px 0', opacity: '0.5' }}>\r\n                                        <Bell size={24} style={{ marginBottom: '10px' }} />\r\n                                        <p style={{ margin: 0, fontSize: '0.9rem' }}>No notifications</p>\r\n                                    </div>\r\n                                ) : (\r\n                                    notifications.map(n => (\r\n                                        <div\r\n                                            key={n._id}\r\n                                            onClick={() => {\r\n                                                markAsRead(n._id);\r\n                                                if (n.link) navigate(n.link);\r\n                                                setShowNotifications(false);\r\n                                            }}\r\n                                            style={{\r\n                                                padding: '12px 15px', borderRadius: '12px', marginBottom: '8px',\r\n                                                background: n.isRead ? 'rgba(255,255,255,0.03)' : 'rgba(99, 102, 241, 0.1)',\r\n                                                border: '1px solid', borderColor: n.isRead ? 'transparent' : 'rgba(99, 102, 241, 0.2)',\r\n                                                cursor: 'pointer', display: 'grid', gridTemplateColumns: 'auto 1fr', gap: '12px',\r\n                                                alignItems: 'start', transition: '0.3s'\r\n                                            }}\r\n                                        >\r\n                                            <div style={{ marginTop: '3px' }}>{getIcon(n.type)}</div>\r\n                                            <div>\r\n                                                <p style={{ margin: '0 0 2px 0', fontSize: '0.9rem', fontWeight: 'bold', color: 'white' }}>{n.title}</p>\r\n                                                <p style={{ margin: '0 0 4px 0', fontSize: '0.8rem', color: 'rgba(255,255,255,0.6)', lineHeight: '1.4' }}>{n.message}</p>\r\n                                                <span style={{ fontSize: '0.7rem', opacity: '0.4' }}>{new Date(n.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n\r\n                            <div style={{ borderTop: '1px solid #1e293b', paddingTop: '10px', textAlign: 'center' }}>\r\n                                <Link\r\n                                    to=\"/notifications\"\r\n                                    onClick={() => setShowNotifications(false)}\r\n                                    style={{ color: 'var(--accent-primary)', fontSize: '0.8rem', fontWeight: 'bold', textDecoration: 'none' }}\r\n                                >\r\n                                    View All Notifications\r\n                                </Link>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', gap: '15px', alignItems: 'center', borderLeft: '1px solid var(--glass-border)', paddingLeft: '20px' }}>\r\n                    <Link to=\"/profile\" style={{ display: 'flex', gap: '15px', alignItems: 'center', textDecoration: 'none', color: 'inherit' }}>\r\n                        <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-end' }}>\r\n                            <span style={{ fontSize: '0.9rem', fontWeight: 'bold' }}>{user?.name}</span>\r\n                            <span className={`chip ${user?.role === 'professor' ? 'warning' : 'success'}`} style={{ fontSize: '0.7rem', padding: '2px 8px', margin: 0 }}>\r\n                                {user?.role?.toUpperCase()}\r\n                            </span>\r\n                        </div>\r\n                    </Link>\r\n\r\n                    <button onClick={handleLogout} className=\"btn-glow\" style={{\r\n                        padding: '8px 12px',\r\n                        fontSize: '0.8rem',\r\n                        background: 'rgba(255,255,255,0.05)',\r\n                        border: '1px solid var(--glass-border)',\r\n                        boxShadow: 'none',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        gap: '8px'\r\n                    }}>\r\n                        <LogOut size={14} />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </nav>\r\n    );\r\n};\r\n\r\nexport default Navbar;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\components\\OverallAttendanceBar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\components\\ProtectedRoute.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\context\\AuthContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":6,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":6,"endColumn":21},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: This value cannot be modified\n\nModifying a value previously passed as an argument to a hook is not allowed. Consider moving the modification before calling the hook.\n\n  22 |             const token = localStorage.getItem('token');\n  23 |             if (token) {\n> 24 |                 api.defaults.headers.common['x-auth-token'] = token;\n     |                 ^^^ `api` cannot be modified\n  25 |                 try {\n  26 |                     const res = await api.get('/auth/me');\n  27 |                     setUser(res.data);","line":24,"column":17,"nodeType":null,"endLine":24,"endColumn":20},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":28,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":29},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'api'. Either include it or remove the dependency array.","line":37,"column":8,"nodeType":"ArrayExpression","endLine":37,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [api]","fix":{"range":[1226,1228],"text":"[api]"}}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: This value cannot be modified\n\nModifying a value previously passed as an argument to a hook is not allowed. Consider moving the modification before calling the hook.\n\n  40 |         const res = await api.post('/auth/login', { email, password });\n  41 |         localStorage.setItem('token', res.data.token);\n> 42 |         api.defaults.headers.common['x-auth-token'] = res.data.token;\n     |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^ `api` cannot be modified\n  43 |         setUser(res.data.user);\n  44 |     };\n  45 |","line":42,"column":9,"nodeType":null,"endLine":42,"endColumn":36},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: This value cannot be modified\n\nModifying a value previously passed as an argument to a hook is not allowed. Consider moving the modification before calling the hook.\n\n  47 |         const res = await api.post('/auth/register', userData);\n  48 |         localStorage.setItem('token', res.data.token);\n> 49 |         api.defaults.headers.common['x-auth-token'] = res.data.token;\n     |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^ `api` cannot be modified\n  50 |         setUser(res.data.user);\n  51 |     };\n  52 |","line":49,"column":9,"nodeType":null,"endLine":49,"endColumn":36},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: This value cannot be modified\n\nModifying a value previously passed as an argument to a hook is not allowed. Consider moving the modification before calling the hook.\n\n  53 |     const logout = () => {\n  54 |         localStorage.removeItem('token');\n> 55 |         delete api.defaults.headers.common['x-auth-token'];\n     |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^ `api` cannot be modified\n  56 |         setUser(null);\n  57 |     };\n  58 |","line":55,"column":16,"nodeType":null,"endLine":55,"endColumn":43}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useState, useEffect, useContext, useMemo } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    const [user, setUser] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const api = useMemo(() => axios.create({\r\n        baseURL: '/api',\r\n        headers: { 'Content-Type': 'application/json' }\r\n    }), []);\r\n\r\n    console.log(\"Current API Base URL:\", api.defaults.baseURL); // DEBUG LOG\r\n\r\n\r\n    useEffect(() => {\r\n        const loadUser = async () => {\r\n            const token = localStorage.getItem('token');\r\n            if (token) {\r\n                api.defaults.headers.common['x-auth-token'] = token;\r\n                try {\r\n                    const res = await api.get('/auth/me');\r\n                    setUser(res.data);\r\n                } catch (err) {\r\n                    localStorage.removeItem('token');\r\n                    delete api.defaults.headers.common['x-auth-token'];\r\n                    setUser(null);\r\n                }\r\n            }\r\n            setLoading(false);\r\n        };\r\n        loadUser();\r\n    }, []);\r\n\r\n    const login = async (email, password) => {\r\n        const res = await api.post('/auth/login', { email, password });\r\n        localStorage.setItem('token', res.data.token);\r\n        api.defaults.headers.common['x-auth-token'] = res.data.token;\r\n        setUser(res.data.user);\r\n    };\r\n\r\n    const register = async (userData) => {\r\n        const res = await api.post('/auth/register', userData);\r\n        localStorage.setItem('token', res.data.token);\r\n        api.defaults.headers.common['x-auth-token'] = res.data.token;\r\n        setUser(res.data.user);\r\n    };\r\n\r\n    const logout = () => {\r\n        localStorage.removeItem('token');\r\n        delete api.defaults.headers.common['x-auth-token'];\r\n        setUser(null);\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ user, loading, login, register, logout, api }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\main.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\pages\\AdminPanel.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":80,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":80,"endColumn":21},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":91,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":91,"endColumn":21},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":106,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":106,"endColumn":21}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport AnalyticsCard from '../components/AnalyticsCard';\r\nimport {\r\n    Users,\r\n    Shield,\r\n    Trash2,\r\n    BookOpen,\r\n    Database,\r\n    Search,\r\n    UserPlus,\r\n    UserMinus,\r\n    AlertCircle\r\n} from 'lucide-react';\r\n\r\nconst AdminPanel = () => {\r\n    const { api } = useAuth();\r\n    const [stats, setStats] = useState(null);\r\n    const [users, setUsers] = useState([]);\r\n    const [classes, setClasses] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [activeTab, setActiveTab] = useState('users');\r\n    const [logs, setLogs] = useState([]); // Audit Logs State\r\n    const { user } = useAuth(); // Get user to check role\r\n\r\n    // Super Admin State\r\n    const [institutions, setInstitutions] = useState([]);\r\n    const [newInst, setNewInst] = useState({ name: '', code: '', address: '' });\r\n    const [newAdmin, setNewAdmin] = useState({ name: '', email: '', password: '', institutionId: '' });\r\n    const [userAnalytics, setUserAnalytics] = useState([]);\r\n    const [attendanceAnalytics, setAttendanceAnalytics] = useState([]);\r\n\r\n    useEffect(() => {\r\n        const fetchAdminData = async () => {\r\n            console.log(\"Fetching Admin Data...\");\r\n            try {\r\n                if (user?.role === 'super_admin') {\r\n                    try {\r\n                        const res = await api.get('/institutions/all');\r\n                        setInstitutions(res.data);\r\n                    } catch (err) {\r\n                        console.error('Failed to fetch institutions for super admin', err);\r\n                    }\r\n                    // Super admin might want to see global stats or select an institution to view\r\n                    // For now, let's just fetch global users/classes/stats\r\n                }\r\n\r\n                const [statsRes, usersRes, classesRes, logsRes, userAnalyticsRes, attendanceAnalyticsRes] = await Promise.all([\r\n                    api.get('/admin/stats'),\r\n                    api.get('/admin/users'),\r\n                    api.get('/admin/classes'),\r\n                    api.get('/logs'),\r\n                    api.get('/admin/analytics/users'),\r\n                    api.get('/admin/analytics/attendance')\r\n                ]);\r\n                console.log(\"Admin Data Fetched:\", { stats: statsRes.data, users: usersRes.data });\r\n                setStats(statsRes.data);\r\n                setUsers(usersRes.data);\r\n                setClasses(classesRes.data);\r\n                setLogs(logsRes.data);\r\n                setUserAnalytics(userAnalyticsRes.data);\r\n                setAttendanceAnalytics(attendanceAnalyticsRes.data);\r\n            } catch (err) {\r\n                console.error('Failed to fetch admin data', err);\r\n                alert(\"Failed to load admin data. Check console for details.\");\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchAdminData();\r\n    }, [api, user]);\r\n\r\n    const createInstitution = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            await api.post('/api/institutions/create', newInst);\r\n            alert('Institution Created');\r\n            window.location.reload();\r\n        } catch (err) {\r\n            alert('Failed to create institution');\r\n        }\r\n    };\r\n\r\n    const createCollegeAdmin = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            await api.post('/api/institutions/add-admin', newAdmin);\r\n            alert('College Admin Created');\r\n            window.location.reload();\r\n        } catch (err) {\r\n            alert('Failed to create admin');\r\n        }\r\n    };\r\n\r\n    const deleteUser = async (id) => {\r\n        if (!window.confirm('Are you sure you want to delete this user? This action cannot be undone.')) return;\r\n        try {\r\n            await api.delete(`/api/admin/user/${id}`);\r\n            setUsers(users.filter(u => u._id !== id));\r\n            // Update stats\r\n            setStats(prev => ({\r\n                ...prev,\r\n                users: { ...prev.users, total: prev.users.total - 1 }\r\n            }));\r\n        } catch (err) {\r\n            alert('Failed to delete user');\r\n        }\r\n    };\r\n\r\n    if (loading) return (\r\n        <div className=\"flex-center\" style={{ height: '80vh', flexDirection: 'column', gap: '20px' }}>\r\n            <div className=\"loader\"></div>\r\n            <div style={{ color: 'var(--text-muted)' }}>Loading Admin Panel...</div>\r\n        </div>\r\n    );\r\n\r\n    const filteredUsers = users.filter(u =>\r\n        u.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        u.email.toLowerCase().includes(searchQuery.toLowerCase())\r\n    );\r\n\r\n    const filteredClasses = classes.filter(c =>\r\n        c.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        c.code.toLowerCase().includes(searchQuery.toLowerCase())\r\n    );\r\n\r\n    return (\r\n        <div className=\"content-wrapper fade-in\" style={{ padding: '40px 5%' }}>\r\n\r\n            <div style={{ marginBottom: '40px' }}>\r\n                <h1 style={{ fontSize: '2.5rem', fontWeight: '800', display: 'flex', alignItems: 'center', gap: '15px' }}>\r\n                    <Shield size={40} color=\"var(--accent-secondary)\" /> Admin Oversight\r\n                </h1>\r\n                <p className=\"text-muted\">Global system management and auditing tools.</p>\r\n            </div>\r\n\r\n            {/* KPI Cards */}\r\n            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '20px', marginBottom: '40px' }}>\r\n                <div className=\"glass-panel card\" style={{ padding: '25px', display: 'flex', alignItems: 'center', gap: '20px' }}>\r\n                    <div style={{ background: 'rgba(var(--accent-primary-rgb), 0.1)', padding: '15px', borderRadius: '15px' }}>\r\n                        <Users size={30} color=\"var(--accent-primary)\" />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"text-muted\" style={{ fontSize: '0.8rem' }}>Total Users</div>\r\n                        <div style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>{stats?.users.total}</div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"glass-panel card\" style={{ padding: '25px', display: 'flex', alignItems: 'center', gap: '20px' }}>\r\n                    <div style={{ background: 'rgba(var(--accent-secondary-rgb), 0.1)', padding: '15px', borderRadius: '15px' }}>\r\n                        <BookOpen size={30} color=\"var(--accent-secondary)\" />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"text-muted\" style={{ fontSize: '0.8rem' }}>Active Classes</div>\r\n                        <div style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>{stats?.classes}</div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"glass-panel card\" style={{ padding: '25px', display: 'flex', alignItems: 'center', gap: '20px' }}>\r\n                    <div style={{ background: 'rgba(255,107,107, 0.1)', padding: '15px', borderRadius: '15px' }}>\r\n                        <Database size={30} color=\"#ff6b6b\" />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"text-muted\" style={{ fontSize: '0.8rem' }}>Attendance Logs</div>\r\n                        <div style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>{stats?.attendanceLogs}</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Tabs */}\r\n            <div className=\"glass-panel\" style={{ padding: '5px', borderRadius: '15px', display: 'inline-flex', gap: '5px', marginBottom: '30px' }}>\r\n                {['users', 'classes', 'analytics', 'audit', ...(user?.role === 'super_admin' ? ['institutions'] : [])].map(tab => (\r\n                    <button\r\n                        key={tab}\r\n                        onClick={() => setActiveTab(tab)}\r\n                        style={{\r\n                            padding: '10px 25px',\r\n                            borderRadius: '12px',\r\n                            border: 'none',\r\n                            background: activeTab === tab ? 'var(--accent-primary)' : 'transparent',\r\n                            color: activeTab === tab ? 'white' : 'var(--text-muted)',\r\n                            fontWeight: 'bold',\r\n                            cursor: 'pointer',\r\n                            textTransform: 'capitalize'\r\n                        }}\r\n                    >\r\n                        {tab}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Management Section */}\r\n            <div className=\"glass-panel\" style={{ padding: '30px' }}>\r\n\r\n                {activeTab !== 'analytics' && (\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '30px' }}>\r\n                        <h2 style={{ textTransform: 'capitalize' }}>Manage {activeTab}</h2>\r\n                        <div style={{ position: 'relative' }}>\r\n                            <Search size={18} style={{ position: 'absolute', left: '15px', top: '50%', transform: 'translateY(-50%)', opacity: 0.3 }} />\r\n                            <input\r\n                                type=\"text\"\r\n                                className=\"input-glass\"\r\n                                placeholder={`Search ${activeTab}...`}\r\n                                style={{ paddingLeft: '45px', width: '300px' }}\r\n                                value={searchQuery}\r\n                                onChange={(e) => setSearchQuery(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {activeTab === 'users' && (\r\n                    <div style={{ overflowX: 'auto' }}>\r\n                        <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                            <thead>\r\n                                <tr style={{ textAlign: 'left', borderBottom: '1px solid var(--accent-primary)' }}>\r\n                                    <th style={{ padding: '15px' }}>User</th>\r\n                                    <th style={{ padding: '15px' }}>Role</th>\r\n                                    <th style={{ padding: '15px' }}>Created</th>\r\n                                    <th style={{ padding: '15px' }}>Status</th>\r\n                                    <th style={{ padding: '15px', textAlign: 'right' }}>Actions</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                {filteredUsers.map(user => (\r\n                                    <tr key={user._id} style={{ borderBottom: '1px solid var(--glass-border)' }}>\r\n                                        <td style={{ padding: '15px' }}>\r\n                                            <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>\r\n                                                <div style={{ width: '40px', height: '40px', borderRadius: '50%', background: 'rgba(255,255,255,0.05)', overflow: 'hidden' }} className=\"flex-center\">\r\n                                                    {user.profilePic ? (\r\n                                                        <img src={user.profilePic} alt={user.name} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />\r\n                                                    ) : (\r\n                                                        <Users size={20} style={{ opacity: 0.2 }} />\r\n                                                    )}\r\n                                                </div>\r\n                                                <div>\r\n                                                    <div style={{ fontWeight: 'bold' }}>{user.name}</div>\r\n                                                    <div className=\"text-muted\" style={{ fontSize: '0.8rem' }}>{user.email}</div>\r\n                                                    <div style={{ fontSize: '0.7rem', color: 'var(--accent-secondary)', fontWeight: 'bold' }}>\r\n                                                        {user.institutionId?.name || 'Default University'}\r\n                                                    </div>\r\n                                                    {user.role === 'student' && (\r\n                                                        <div className=\"text-muted\" style={{ fontSize: '0.7rem', marginTop: '4px' }}>\r\n                                                            {user.universityRollNo && `Uni Roll: ${user.universityRollNo}`}\r\n                                                            {user.universityRollNo && user.classRollNo && ' | '}\r\n                                                            {user.classRollNo && `Class Roll: ${user.classRollNo}`}\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                        </td>\r\n                                        <td style={{ padding: '15px' }}>\r\n                                            <div className={`chip ${user.role === 'professor' ? 'warning' : user.role === 'admin' ? 'critical' : 'success'}`}>\r\n                                                {user.role.toUpperCase()}\r\n                                            </div>\r\n                                        </td>\r\n                                        <td style={{ padding: '15px' }}>{new Date(user.createdAt).toLocaleDateString()}</td>\r\n                                        <td style={{ padding: '15px' }}>\r\n                                            {user.isFaceRegistered ? (\r\n                                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px', color: 'var(--status-success)', fontSize: '0.8rem' }}>\r\n                                                    <Shield size={12} /> Verified\r\n                                                </div>\r\n                                            ) : (\r\n                                                <div style={{ opacity: 0.5, fontSize: '0.8rem' }}>Unverified</div>\r\n                                            )}\r\n                                        </td>\r\n                                        <td style={{ padding: '15px', textAlign: 'right' }}>\r\n                                            {user.role !== 'admin' && (\r\n                                                <button\r\n                                                    onClick={() => deleteUser(user._id)}\r\n                                                    style={{ background: 'transparent', border: 'none', cursor: 'pointer', color: '#ff6b6b' }}\r\n                                                    title=\"Delete User\"\r\n                                                >\r\n                                                    <Trash2 size={18} />\r\n                                                </button>\r\n                                            )}\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                )}\r\n\r\n                {activeTab === 'classes' && (\r\n                    <div style={{ overflowX: 'auto' }}>\r\n                        <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                            <thead>\r\n                                <tr style={{ textAlign: 'left', borderBottom: '1px solid var(--accent-secondary)' }}>\r\n                                    <th style={{ padding: '15px' }}>Class Name</th>\r\n                                    <th style={{ padding: '15px' }}>Code</th>\r\n                                    <th style={{ padding: '15px' }}>Professor</th>\r\n                                    <th style={{ padding: '15px' }}>Students</th>\r\n                                    <th style={{ padding: '15px', textAlign: 'right' }}>Actions</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                {filteredClasses.map(cls => (\r\n                                    <tr key={cls._id} style={{ borderBottom: '1px solid var(--glass-border)' }}>\r\n                                        <td style={{ padding: '15px', fontWeight: 'bold' }}>{cls.name}</td>\r\n                                        <td style={{ padding: '15px' }}><div className=\"chip\">#{cls.code}</div></td>\r\n                                        <td style={{ padding: '15px' }}>{cls.professor?.name || 'Unknown'}</td>\r\n                                        <td style={{ padding: '15px' }}>{cls.students.length} Enrolled</td>\r\n                                        <td style={{ padding: '15px', textAlign: 'right' }}>\r\n                                            <button style={{ background: 'transparent', border: 'none', cursor: 'pointer', color: 'var(--accent-primary)' }}>\r\n                                                <AlertCircle size={18} />\r\n                                            </button>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                )}\r\n\r\n                {activeTab === 'analytics' && (\r\n                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(400px, 1fr))', gap: '30px' }}>\r\n                        <AnalyticsCard title=\"System Growth (New Users)\" type=\"area\" data={userAnalytics} />\r\n                        <AnalyticsCard title=\"Global Attendance Rate\" type=\"line\" data={attendanceAnalytics} />\r\n                    </div>\r\n                )}\r\n\r\n                {activeTab === 'audit' && (\r\n                    <div style={{ overflowX: 'auto' }}>\r\n                        <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                            <thead>\r\n                                <tr style={{ textAlign: 'left', borderBottom: '1px solid var(--accent-secondary)' }}>\r\n                                    <th style={{ padding: '15px' }}>Action</th>\r\n                                    <th style={{ padding: '15px' }}>Performed By</th>\r\n                                    <th style={{ padding: '15px' }}>Target</th>\r\n                                    <th style={{ padding: '15px' }}>Timestamp</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                {logs.map(log => (\r\n                                    <tr key={log._id} style={{ borderBottom: '1px solid var(--glass-border)' }}>\r\n                                        <td style={{ padding: '15px', fontWeight: 'bold', color: 'var(--accent-primary)' }}>{log.action}</td>\r\n                                        <td style={{ padding: '15px' }}>{log.performedBy?.name || 'Unknown'}</td>\r\n                                        <td style={{ padding: '15px' }}>{log.target}</td>\r\n                                        <td style={{ padding: '15px', color: 'var(--text-muted)' }}>{new Date(log.timestamp).toLocaleString()}</td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                )}\r\n\r\n                {activeTab === 'institutions' && user?.role === 'super_admin' && (\r\n                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '30px' }}>\r\n                        <div className=\"glass-panel card\" style={{ padding: '20px' }}>\r\n                            <h3>Create Institution</h3>\r\n                            <form onSubmit={createInstitution} style={{ display: 'flex', flexDirection: 'column', gap: '10px', marginTop: '15px' }}>\r\n                                <input className=\"input-glass\" placeholder=\"Name\" value={newInst.name} onChange={e => setNewInst({ ...newInst, name: e.target.value })} required />\r\n                                <input className=\"input-glass\" placeholder=\"Code (e.g. IITD)\" value={newInst.code} onChange={e => setNewInst({ ...newInst, code: e.target.value })} required />\r\n                                <input className=\"input-glass\" placeholder=\"Address\" value={newInst.address} onChange={e => setNewInst({ ...newInst, address: e.target.value })} />\r\n                                <button className=\"btn-glow\">Create</button>\r\n                            </form>\r\n\r\n                            <hr style={{ margin: '20px 0', borderColor: 'var(--glass-border)' }} />\r\n\r\n                            <h4>Existing Institutions</h4>\r\n                            <ul style={{ listStyle: 'none', padding: 0, marginTop: '10px', maxHeight: '200px', overflowY: 'auto' }}>\r\n                                {institutions.map(inst => (\r\n                                    <li key={inst._id} style={{ padding: '10px', borderBottom: '1px solid var(--glass-border)' }}>\r\n                                        <strong>{inst.name}</strong> ({inst.code})\r\n                                    </li>\r\n                                ))}\r\n                            </ul>\r\n                        </div>\r\n\r\n                        <div className=\"glass-panel card\" style={{ padding: '20px' }}>\r\n                            <h3>Add College Admin</h3>\r\n                            <form onSubmit={createCollegeAdmin} style={{ display: 'flex', flexDirection: 'column', gap: '10px', marginTop: '15px' }}>\r\n                                <select className=\"input-glass\" value={newAdmin.institutionId} onChange={e => setNewAdmin({ ...newAdmin, institutionId: e.target.value })} required>\r\n                                    <option value=\"\">Select Institution</option>\r\n                                    {institutions.map(inst => (\r\n                                        <option key={inst._id} value={inst._id}>{inst.name}</option>\r\n                                    ))}\r\n                                </select>\r\n                                <input className=\"input-glass\" placeholder=\"Admin Name\" value={newAdmin.name} onChange={e => setNewAdmin({ ...newAdmin, name: e.target.value })} required />\r\n                                <input className=\"input-glass\" type=\"email\" placeholder=\"Email\" value={newAdmin.email} onChange={e => setNewAdmin({ ...newAdmin, email: e.target.value })} required />\r\n                                <input className=\"input-glass\" type=\"password\" placeholder=\"Password\" value={newAdmin.password} onChange={e => setNewAdmin({ ...newAdmin, password: e.target.value })} required />\r\n                                <button className=\"btn-glow\">Create Admin</button>\r\n                            </form>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AdminPanel;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\pages\\Attendance.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":30,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"loading"},"fix":{"range":[926,933],"text":""},"desc":"Remove unused variable 'loading'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect } from 'react';\r\nimport * as faceapi from 'face-api.js';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport {\r\n    Camera,\r\n    Image as ImageIcon,\r\n    X,\r\n    Plus,\r\n    Search,\r\n    CheckCircle,\r\n    Pause,\r\n    Play,\r\n    Save\r\n} from 'lucide-react';\r\n\r\nconst Attendance = () => {\r\n    const { classCode } = useParams();\r\n    const videoRef = useRef();\r\n    const canvasRef = useRef();\r\n    const [imagePreview, setImagePreview] = useState(null);\r\n    const { api } = useAuth();\r\n\r\n    const [students, setStudents] = useState([]);\r\n    const [present, setPresent] = useState(new Set());\r\n    const [isScanning, setIsScanning] = useState(false);\r\n    const [matcher, setMatcher] = useState(null);\r\n    const [manualSearch, setManualSearch] = useState('');\r\n    const [mode, setMode] = useState('camera');\r\n    const [loading, setLoading] = useState(true);\r\n    const navigate = useNavigate();\r\n\r\n    // 1. Load AI Models\r\n    useEffect(() => {\r\n        const loadModels = async () => {\r\n            try {\r\n                const MODEL_URL = 'https://justadudewhohacks.github.io/face-api.js/models';\r\n                await Promise.all([\r\n                    faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL),\r\n                    faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n                    faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)\r\n                ]);\r\n                setLoading(false);\r\n            } catch (err) {\r\n                console.error(\"Failed to load models:\", err);\r\n                alert(\"Failed to load AI models. Please check your internet connection.\");\r\n            }\r\n        };\r\n        loadModels();\r\n    }, []);\r\n\r\n    // 2. Fetch Class Students & Build Matcher\r\n    useEffect(() => {\r\n        const fetchStudents = async () => {\r\n            try {\r\n                const res = await api.get(`/classes/${classCode}/students`);\r\n                setStudents(res.data);\r\n\r\n                // Create Labeled Descriptors for Face Matcher\r\n                const labeledDescriptors = res.data\r\n                    .filter(s => s.isFaceRegistered && s.faceDescriptor && s.faceDescriptor.length > 0)\r\n                    .map(s => new faceapi.LabeledFaceDescriptors(s._id, [new Float32Array(s.faceDescriptor)]));\r\n\r\n                if (labeledDescriptors.length > 0) {\r\n                    setMatcher(new faceapi.FaceMatcher(labeledDescriptors, 0.6));\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Error fetching students:\", err);\r\n                alert(\"Failed to load student list.\");\r\n            }\r\n        };\r\n        if (classCode) {\r\n            fetchStudents();\r\n        }\r\n    }, [classCode, api]);\r\n\r\n    // Live AI Loop with Drawing\r\n    useEffect(() => {\r\n        let interval;\r\n        if (isScanning && mode === 'camera' && matcher) {\r\n            interval = setInterval(async () => {\r\n                if (videoRef.current && canvasRef.current) {\r\n                    const detections = await faceapi.detectAllFaces(videoRef.current, new faceapi.SsdMobilenetv1Options({ minConfidence: 0.5 }))\r\n                        .withFaceLandmarks()\r\n                        .withFaceDescriptors();\r\n\r\n                    const displaySize = { width: videoRef.current.videoWidth, height: videoRef.current.videoHeight };\r\n                    faceapi.matchDimensions(canvasRef.current, displaySize);\r\n\r\n                    const resizedDetections = faceapi.resizeResults(detections, displaySize);\r\n                    const ctx = canvasRef.current.getContext('2d');\r\n                    ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n\r\n                    const results = resizedDetections.map(d => matcher.findBestMatch(d.descriptor));\r\n\r\n                    results.forEach((result, i) => {\r\n                        const box = resizedDetections[i].detection.box;\r\n                        const drawBox = new faceapi.draw.DrawBox(box, { label: result.toString() });\r\n                        drawBox.draw(canvasRef.current);\r\n\r\n                        if (result.label !== 'unknown') {\r\n                            setPresent(prev => new Set(prev).add(result.label));\r\n                        }\r\n                    });\r\n                }\r\n            }, 100); // 10 FPS\r\n        }\r\n        return () => clearInterval(interval);\r\n    }, [isScanning, matcher, mode]);\r\n\r\n    // Photo Upload Handler\r\n    const handleImageUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        // Preview\r\n        const imgUrl = URL.createObjectURL(file);\r\n        setImagePreview(imgUrl);\r\n\r\n        // Process\r\n        const img = await faceapi.fetchImage(imgUrl);\r\n        const detections = await faceapi.detectAllFaces(img, new faceapi.SsdMobilenetv1Options({ minConfidence: 0.5 }))\r\n            .withFaceLandmarks()\r\n            .withFaceDescriptors();\r\n\r\n        if (matcher) {\r\n            const results = detections.map(d => matcher.findBestMatch(d.descriptor));\r\n            let count = 0;\r\n            results.forEach(result => {\r\n                if (result.label !== 'unknown') {\r\n                    setPresent(prev => new Set(prev).add(result.label));\r\n                    count++;\r\n                }\r\n            });\r\n            alert(`Processed Photo: Found ${count} students.`);\r\n        }\r\n    };\r\n\r\n    // Manual Add\r\n    const toggleStudent = (id) => {\r\n        setPresent(prev => {\r\n            const newSet = new Set(prev);\r\n            if (newSet.has(id)) newSet.delete(id);\r\n            else newSet.add(id);\r\n            return newSet;\r\n        });\r\n    };\r\n\r\n    const saveAttendance = async () => {\r\n        try {\r\n            await api.post('/classes/mark', {\r\n                classCode,\r\n                studentsPresent: Array.from(present)\r\n            });\r\n            alert('Attendance Saved!');\r\n            navigate('/dashboard');\r\n        } catch (err) {\r\n            console.error(err);\r\n            alert('Error saving attendance');\r\n        }\r\n    };\r\n\r\n    // Filter students for manual entry\r\n    const absentStudents = students.filter(s => !present.has(s._id) && s.name.toLowerCase().includes(manualSearch.toLowerCase()));\r\n\r\n    return (\r\n        <div className=\"content-wrapper flex-center\" style={{ flexDirection: 'column', minHeight: '100vh', paddingBottom: '50px' }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', width: '100%', maxWidth: '1000px', alignItems: 'center' }}>\r\n                <h2 className=\"text-gradient\">Take Attendance</h2>\r\n                <div style={{ background: 'rgba(255,255,255,0.1)', borderRadius: '20px', padding: '5px' }}>\r\n                    <button onClick={() => setMode('camera')} className={mode === 'camera' ? 'btn-glow' : 'btn-outline'} style={{ border: 'none', marginRight: '5px' }}>Live Camera</button>\r\n                    <button onClick={() => setMode('photo')} className={mode === 'photo' ? 'btn-glow' : 'btn-outline'} style={{ border: 'none' }}>Upload Photo</button>\r\n                </div>\r\n            </div>\r\n\r\n            <div style={{ display: 'flex', gap: '20px', width: '100%', maxWidth: '1000px', margin: '20px 0', flexWrap: 'wrap' }}>\r\n\r\n                {/* Left Panel: Input Source */}\r\n                <div className=\"glass-panel\" style={{ flex: 2, padding: '10px', minHeight: '400px', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative' }}>\r\n                    {mode === 'camera' ? (\r\n                        <>\r\n                            <video ref={videoRef} autoPlay muted style={{ width: '100%', borderRadius: '15px' }} />\r\n                            <canvas ref={canvasRef} style={{ position: 'absolute', top: '10px', left: '10px' }} />\r\n                        </>\r\n                    ) : (\r\n                        <div style={{ textAlign: 'center', width: '100%' }}>\r\n                            {imagePreview ? (\r\n                                <img src={imagePreview} alt=\"Class\" style={{ width: '100%', maxHeight: '400px', objectFit: 'contain', borderRadius: '15px' }} />\r\n                            ) : (\r\n                                <div style={{ padding: '50px' }}>\r\n                                    <ImageIcon size={48} style={{ marginBottom: '10px', color: 'var(--text-muted)' }} />\r\n                                    <p>Upload a group photo of the class</p>\r\n                                </div>\r\n                            )}\r\n                            <input type=\"file\" accept=\"image/*\" onChange={handleImageUpload} style={{ marginTop: '20px', color: 'white' }} />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Right Panel: List & Manual */}\r\n                <div className=\"glass-panel\" style={{ flex: 1, padding: '20px', minWidth: '300px' }}>\r\n                    <h3 style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\r\n                        <CheckCircle size={20} color=\"var(--status-success)\" /> Present: {present.size}\r\n                    </h3>\r\n\r\n                    <div style={{ maxHeight: '200px', overflowY: 'auto', margin: '15px 0', borderBottom: '1px solid var(--glass-border)', paddingBottom: '10px' }}>\r\n                        {Array.from(present).map(id => {\r\n                            const s = students.find(stud => stud._id === id);\r\n                            return (\r\n                                <div key={id} className=\"chip success\" style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '5px', width: '100%' }}>\r\n                                    <span>{s?.name || id}</span>\r\n                                    <X size={14} style={{ cursor: 'pointer' }} onClick={() => toggleStudent(id)} />\r\n                                </div>\r\n                            )\r\n                        })}\r\n                    </div>\r\n\r\n                    <h4 style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\r\n                        <Search size={16} /> Manual Override\r\n                    </h4>\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search missing student...\"\r\n                        className=\"input-glass\"\r\n                        style={{ padding: '8px', fontSize: '0.9rem', marginBottom: '10px' }}\r\n                        value={manualSearch}\r\n                        onChange={(e) => setManualSearch(e.target.value)}\r\n                    />\r\n                    <div style={{ maxHeight: '150px', overflowY: 'auto' }}>\r\n                        {absentStudents.map(s => (\r\n                            <div key={s._id} onClick={() => toggleStudent(s._id)} style={{ padding: '8px', cursor: 'pointer', borderBottom: '1px solid rgba(255,255,255,0.05)', display: 'flex', justifyContent: 'space-between' }}>\r\n                                <span>{s.name}</span>\r\n                                <Plus size={14} className=\"text-gradient\" />\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div style={{ display: 'flex', gap: '20px' }}>\r\n                {mode === 'camera' && (\r\n                    !isScanning ? (\r\n                        <button onClick={() => setIsScanning(true)} className=\"btn-glow\" style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                            <Play size={16} /> Start Scanning\r\n                        </button>\r\n                    ) : (\r\n                        <button onClick={() => setIsScanning(false)} className=\"btn-outline\" style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                            <Pause size={16} /> Pause\r\n                        </button>\r\n                    )\r\n                )}\r\n                <button onClick={saveAttendance} className=\"btn-glow\" style={{ background: 'var(--status-success)', display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                    <Save size={16} /> Save Attendance\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Attendance;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\pages\\Classroom.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'getLocation' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":35,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"getLocation"},"fix":{"range":[1266,1847],"text":""},"desc":"Remove unused variable 'getLocation'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'setClassroomLocation' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":54,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":54,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"setClassroomLocation"},"fix":{"range":[1855,2102],"text":""},"desc":"Remove unused variable 'setClassroomLocation'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadClassDetails'. Either include it or remove the dependency array.","line":65,"column":8,"nodeType":"ArrayExpression","endLine":65,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [classCode, api, user, loadClassDetails]","fix":{"range":[2278,2300],"text":"[classCode, api, user, loadClassDetails]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useParams, Link } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport {\r\n    Download,\r\n    MessageSquare,\r\n    Users as UsersIcon,\r\n    History,\r\n    Camera,\r\n    ChevronRight,\r\n    MoreVertical,\r\n    User as UserIcon,\r\n    Presentation\r\n} from 'lucide-react';\r\n\r\nconst Classroom = () => {\r\n    const { classCode } = useParams();\r\n    const { user, api } = useAuth();\r\n    const [activeTab, setActiveTab] = useState('stream');\r\n    const [classData, setClassData] = useState(null);\r\n    const [students, setStudents] = useState([]);\r\n    const [attendanceHistory, setAttendanceHistory] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [newAnnouncement, setNewAnnouncement] = useState('');\r\n    const [showAssignmentModal, setShowAssignmentModal] = useState(false);\r\n    const [showNoteModal, setShowNoteModal] = useState(false);\r\n    const [assignmentTitle, setAssignmentTitle] = useState('');\r\n    const [assignmentDate, setAssignmentDate] = useState('');\r\n    const [noteTitle, setNoteTitle] = useState('');\r\n    const [noteLink, setNoteLink] = useState('');\r\n\r\n    // Geo-Fencing State\r\n    const [location, setLocation] = useState(null);\r\n\r\n    const getLocation = () => {\r\n        if (!navigator.geolocation) {\r\n            alert(\"Geolocation is not supported by your browser\");\r\n            return;\r\n        }\r\n        navigator.geolocation.getCurrentPosition(\r\n            (position) => {\r\n                setLocation({\r\n                    lat: position.coords.latitude,\r\n                    long: position.coords.longitude\r\n                });\r\n                alert(\"Location acquired!\");\r\n            },\r\n            () => {\r\n                alert(\"Unable to retrieve your location\");\r\n            }\r\n        );\r\n    };\r\n\r\n    const setClassroomLocation = async () => {\r\n        if (!location) return alert(\"Get location first\");\r\n        // API call would go here. For demo, we just alert.\r\n        alert(`Class location set to: ${location.lat}, ${location.long}`);\r\n    };\r\n\r\n    useEffect(() => {\r\n        const authLoading = localStorage.getItem('token') && !user;\r\n        if (!authLoading) {\r\n            loadClassDetails();\r\n        }\r\n    }, [classCode, api, user]);\r\n\r\n    const loadClassDetails = async () => {\r\n        try {\r\n            // Get Class Info\r\n            const classesRes = await api.get('/classes/my');\r\n            const currentClass = classesRes.data.find(c => c.code === classCode);\r\n            setClassData(currentClass);\r\n\r\n            // Get Students\r\n            const studentsRes = await api.get(`/classes/${classCode}/students`);\r\n            setStudents(studentsRes.data);\r\n\r\n            // Get Attendance History\r\n            const historyRes = await api.get(`/classes/${classCode}/attendance`);\r\n            setAttendanceHistory(historyRes.data);\r\n\r\n        } catch (err) {\r\n            console.error(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const exportToCSV = () => {\r\n        if (attendanceHistory.length === 0) return;\r\n\r\n        let csvContent = \"data:text/csv;charset=utf-8,\";\r\n        csvContent += \"Date,Session ID,Total Present,Students\\n\";\r\n\r\n        attendanceHistory.forEach(record => {\r\n            const date = new Date(record.date).toLocaleDateString();\r\n            const id = record._id ? record._id.substring(record._id.length - 6).toUpperCase() : 'N/A';\r\n            const count = record.records ? record.records.length : 0;\r\n            const studentNames = record.records ? record.records.map(r => r.student?.name || 'Unknown').join(\"; \") : '';\r\n            csvContent += `${date},${id},${count},\"${studentNames}\"\\n`;\r\n        });\r\n\r\n        const encodedUri = encodeURI(csvContent);\r\n        const link = document.createElement(\"a\");\r\n        link.setAttribute(\"href\", encodedUri);\r\n        link.setAttribute(\"download\", `Attendance_${classCode}.csv`);\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n    };\r\n\r\n    const handlePostAnnouncement = async (e) => {\r\n        if (e.key !== 'Enter' || !newAnnouncement.trim()) return;\r\n        try {\r\n            await api.post(`/classes/${classCode}/announcements`, { text: newAnnouncement });\r\n            setNewAnnouncement('');\r\n            loadClassDetails();\r\n        } catch (err) {\r\n            console.error('Error posting announcement:', err);\r\n        }\r\n    };\r\n\r\n    const handlePostAssignment = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            await api.post(`/classes/${classCode}/assignments`, { title: assignmentTitle, dueDate: assignmentDate });\r\n            setShowAssignmentModal(false);\r\n            setAssignmentTitle('');\r\n            setAssignmentDate('');\r\n            loadClassDetails();\r\n        } catch (err) {\r\n            console.error('Error posting assignment:', err);\r\n        }\r\n    };\r\n\r\n    const handlePostNote = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            await api.post(`/classes/${classCode}/notes`, { title: noteTitle, link: noteLink });\r\n            setShowNoteModal(false);\r\n            setNoteTitle('');\r\n            setNoteLink('');\r\n            loadClassDetails();\r\n        } catch (err) {\r\n            console.error('Error posting note:', err);\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"flex-center\" style={{ height: '80vh' }}><div className=\"loader\"></div></div>;\r\n\r\n    return (\r\n        <div className=\"content-wrapper fade-in\" style={{ padding: '0', maxWidth: '100%', margin: '0' }}>\r\n\r\n            {/* Class Banner */}\r\n            <div style={{\r\n                background: 'linear-gradient(135deg, var(--bg-gradient-mid), var(--bg-gradient-start))',\r\n                padding: '80px 5% 40px',\r\n                borderBottom: '1px solid var(--glass-border)',\r\n                borderRadius: '0 0 40px 40px'\r\n            }}>\r\n                <div style={{ maxWidth: '1200px', margin: '0 auto', display: 'flex', justifyContent: 'space-between', alignItems: 'flex-end' }}>\r\n                    <div>\r\n                        <div className=\"chip warning\" style={{ marginBottom: '10px' }}>#{classData?.code}</div>\r\n                        <h1 style={{ fontSize: 'clamp(1.8rem, 5vw, 3rem)', fontWeight: '800' }}>{classData?.name}</h1>\r\n                        <p className=\"text-muted\" style={{ fontSize: '1.1rem', display: 'flex', alignItems: 'center', gap: '10px' }}>\r\n                            <Presentation size={20} />\r\n                            Prof. {classData?.professorName || 'Dr. Pankaj Sharma'}\r\n                        </p>\r\n                    </div>\r\n                    {user?.role === 'professor' && (\r\n                        <Link to={`/classroom/${classCode}/attendance`} className=\"btn-glow\" style={{ marginBottom: '10px', display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                            <Camera size={18} /> TAKE ATTENDANCE\r\n                        </Link>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            <div style={{ maxWidth: '1200px', margin: '30px auto', padding: '0 20px' }}>\r\n\r\n                {/* Tabs Multi-Select */}\r\n                <div className=\"glass-panel\" style={{\r\n                    display: 'flex',\r\n                    gap: '5px',\r\n                    padding: '5px',\r\n                    borderRadius: '15px',\r\n                    marginBottom: '30px',\r\n                    width: 'fit-content'\r\n                }}>\r\n                    {[\r\n                        { id: 'stream', icon: MessageSquare },\r\n                        { id: 'people', icon: UsersIcon },\r\n                        { id: 'attendance', icon: History }\r\n                    ].map(tab => (\r\n                        <button\r\n                            key={tab.id}\r\n                            onClick={() => setActiveTab(tab.id)}\r\n                            style={{\r\n                                padding: '10px 20px',\r\n                                borderRadius: '12px',\r\n                                border: 'none',\r\n                                background: activeTab === tab.id ? 'var(--accent-primary)' : 'transparent',\r\n                                color: activeTab === tab.id ? 'white' : 'var(--text-muted)',\r\n                                fontWeight: 'bold',\r\n                                cursor: 'pointer',\r\n                                transition: '0.3s',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                gap: '8px',\r\n                                textTransform: 'capitalize'\r\n                            }}\r\n                        >\r\n                            <tab.icon size={16} />\r\n                            {tab.id}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Tab Content */}\r\n                <div className=\"fade-in\">\r\n\r\n                    {activeTab === 'stream' && (\r\n                        <div style={{ display: 'grid', gridTemplateColumns: 'minmax(250px, 1fr) 3fr', gap: '30px' }}>\r\n                            {/* Left: Class Info Sidebar */}\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\r\n                                <div className=\"glass-panel card\">\r\n                                    <h4 style={{ marginBottom: '15px' }}>Class Resources</h4>\r\n                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\r\n                                        {classData?.notes?.length === 0 ? (\r\n                                            <p className=\"text-muted\" style={{ fontSize: '0.8rem' }}>No resources yet.</p>\r\n                                        ) : (\r\n                                            classData?.notes?.map((n, i) => (\r\n                                                <a key={i} href={n.link} target=\"_blank\" rel=\"noreferrer\" style={{ fontSize: '0.85rem', color: 'var(--accent-primary)', textDecoration: 'none', display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                                    <BookOpen size={14} /> {n.title}\r\n                                                </a>\r\n                                            ))\r\n                                        )}\r\n                                    </div>\r\n                                    {user?.role === 'professor' && (\r\n                                        <button onClick={() => setShowNoteModal(true)} className=\"btn-glow\" style={{ padding: '5px 10px', fontSize: '0.7rem', marginTop: '15px', width: '100%' }}>\r\n                                            + Add Material\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <div className=\"glass-panel card\">\r\n                                    <h4 style={{ marginBottom: '15px' }}>Upcoming Assignments</h4>\r\n                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\r\n                                        {classData?.assignments?.length === 0 ? (\r\n                                            <p className=\"text-muted\" style={{ fontSize: '0.8rem' }}>No assignments yet.</p>\r\n                                        ) : (\r\n                                            classData?.assignments?.map((a, i) => (\r\n                                                <div key={i} style={{ fontSize: '0.85rem' }}>\r\n                                                    <div style={{ fontWeight: 'bold' }}>{a.title}</div>\r\n                                                    <div className=\"text-muted\" style={{ fontSize: '0.7rem' }}>Due: {new Date(a.dueDate).toLocaleDateString()}</div>\r\n                                                </div>\r\n                                            ))\r\n                                        )}\r\n                                    </div>\r\n                                    {user?.role === 'professor' && (\r\n                                        <button onClick={() => setShowAssignmentModal(true)} className=\"btn-glow\" style={{ padding: '5px 10px', fontSize: '0.7rem', marginTop: '15px', width: '100%' }}>\r\n                                            + Add Assignment\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Right: Announcements */}\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\r\n                                {user?.role === 'professor' && (\r\n                                    <div className=\"glass-panel\" style={{ padding: '20px', display: 'flex', gap: '15px', alignItems: 'center' }}>\r\n                                        <div style={{ width: '40px', height: '40px', borderRadius: '50%', background: 'var(--accent-primary)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                                            <UserIcon size={20} color=\"white\" />\r\n                                        </div>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            className=\"input-glass\"\r\n                                            placeholder=\"Announce something to your class...\"\r\n                                            value={newAnnouncement}\r\n                                            onChange={(e) => setNewAnnouncement(e.target.value)}\r\n                                            onKeyDown={handlePostAnnouncement}\r\n                                        />\r\n                                    </div>\r\n                                )}\r\n\r\n                                {classData?.announcements?.length === 0 ? (\r\n                                    <div className=\"glass-panel card flex-center\" style={{ height: '200px' }}>\r\n                                        <p className=\"text-muted\">No announcements yet.</p>\r\n                                    </div>\r\n                                ) : (\r\n                                    classData?.announcements?.map((ann, i) => (\r\n                                        <div key={i} className=\"glass-panel card\">\r\n                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '15px' }}>\r\n                                                <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>\r\n                                                    <div style={{ width: '35px', height: '35px', borderRadius: '50%', background: 'var(--accent-secondary)' }}></div>\r\n                                                    <div>\r\n                                                        <div style={{ fontWeight: 'bold', fontSize: '0.9rem' }}>Prof. {classData?.professorName || 'Pankaj Sharma'}</div>\r\n                                                        <div className=\"text-muted\" style={{ fontSize: '0.7rem' }}>{new Date(ann.createdAt).toLocaleDateString()}</div>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <MoreVertical size={16} className=\"text-muted\" style={{ cursor: 'pointer' }} />\r\n                                            </div>\r\n                                            <p>{ann.text}</p>\r\n                                        </div>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {activeTab === 'people' && (\r\n                        <div className=\"glass-panel\" style={{ padding: '30px' }}>\r\n                            <div style={{ borderBottom: '1px solid var(--accent-primary)', paddingBottom: '10px', marginBottom: '20px', display: 'flex', justifyContent: 'space-between' }}>\r\n                                <h2 style={{ color: 'var(--accent-primary)' }}>Professors</h2>\r\n                                <span>1 Total</span>\r\n                            </div>\r\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '15px', marginBottom: '40px' }}>\r\n                                <div style={{ width: '45px', height: '45px', borderRadius: '50%', background: 'var(--accent-primary)' }}></div>\r\n                                <span>{classData?.professorName || 'Dr. Pankaj Sharma'}</span>\r\n                            </div>\r\n\r\n                            <div style={{ borderBottom: '1px solid var(--accent-primary)', paddingBottom: '10px', marginBottom: '20px', display: 'flex', justifyContent: 'space-between' }}>\r\n                                <h2 style={{ color: 'var(--accent-primary)' }}>Students</h2>\r\n                                <span>{students.length} Total</span>\r\n                            </div>\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\r\n                                {students.map(s => (\r\n                                    <div key={s._id} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '15px', borderBottom: '1px solid var(--glass-border)' }}>\r\n                                        <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>\r\n                                            <div style={{ width: '40px', height: '40px', borderRadius: '50%', background: 'rgba(255,255,255,0.05)', overflow: 'hidden' }} className=\"flex-center\">\r\n                                                {s.profilePic ? (\r\n                                                    <img src={s.profilePic} alt={s.name} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />\r\n                                                ) : (\r\n                                                    <UserIcon size={20} style={{ opacity: 0.2 }} />\r\n                                                )}\r\n                                            </div>\r\n                                            <div style={{ display: 'flex', flexDirection: 'column' }}>\r\n                                                <span style={{ fontWeight: 'bold' }}>{s.name}</span>\r\n                                                <span className=\"text-muted\" style={{ fontSize: '0.7rem' }}>\r\n                                                    {s.universityRollNo && `Uni Roll: ${s.universityRollNo}`}\r\n                                                    {s.universityRollNo && s.classRollNo && ' | '}\r\n                                                    {s.classRollNo && `Class Roll: ${s.classRollNo}`}\r\n                                                </span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className={`chip ${s.isFaceRegistered ? 'success' : 'critical'}`}>\r\n                                            {s.isFaceRegistered ? 'Face Registered' : 'Not Registered'}\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {activeTab === 'attendance' && (\r\n                        <div className=\"glass-panel\" style={{ padding: '30px' }}>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '30px' }}>\r\n                                <h2>Attendance Logs</h2>\r\n                                <div style={{ display: 'flex', gap: '10px' }}>\r\n                                    {user?.role === 'professor' && attendanceHistory.length > 0 && (\r\n                                        <button onClick={exportToCSV} className=\"btn-glow btn-outline\" style={{ display: 'flex', alignItems: 'center', gap: '8px', fontSize: '0.8rem' }}>\r\n                                            <Download size={14} /> EXPORT CSV\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {attendanceHistory.length === 0 ? (\r\n                                <p className=\"text-muted\">No attendance sessions recorded yet.</p>\r\n                            ) : (\r\n                                <div style={{ overflowX: 'auto' }}>\r\n                                    <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                                        <thead>\r\n                                            <tr style={{ textAlign: 'left', borderBottom: '1px solid var(--accent-primary)' }}>\r\n                                                <th style={{ padding: '15px' }}>Date</th>\r\n                                                <th style={{ padding: '15px' }}>Session ID</th>\r\n                                                <th style={{ padding: '15px' }}>\r\n                                                    {user?.role === 'professor' ? 'Present Count' : 'My Status'}\r\n                                                </th>\r\n                                                <th style={{ padding: '15px' }}>Action</th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody>\r\n                                            {attendanceHistory.map(record => (\r\n                                                <tr key={record._id} style={{ borderBottom: '1px solid var(--glass-border)' }}>\r\n                                                    <td style={{ padding: '15px' }}>{new Date(record.date).toLocaleDateString()}</td>\r\n                                                    <td style={{ padding: '15px' }}>{record._id.substring(record._id.length - 6).toUpperCase()}</td>\r\n                                                    <td style={{ padding: '15px' }}>\r\n                                                        {user?.role === 'professor' ? (\r\n                                                            <div className=\"chip success\">{record.records.length} Present</div>\r\n                                                        ) : (\r\n                                                            record.records.some(r => r.student?._id === user.id || r.student === user.id) ? (\r\n                                                                <div className=\"chip success\">PRESENT</div>\r\n                                                            ) : (\r\n                                                                <div className=\"chip critical\">ABSENT</div>\r\n                                                            )\r\n                                                        )}\r\n                                                    </td>\r\n                                                    <td style={{ padding: '15px' }}>\r\n                                                        <button className=\"btn-glow\" style={{ padding: '5px 15px', fontSize: '0.7rem' }}>DETAILS</button>\r\n                                                    </td>\r\n                                                </tr>\r\n                                            ))}\r\n                                        </tbody>\r\n                                    </table>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                </div>\r\n            </div>\r\n\r\n            {/* Assignment Modal */}\r\n            {showAssignmentModal && (\r\n                <div className=\"flex-center\" style={{ position: 'fixed', top: 0, left: 0, width: '100%', height: '100%', background: 'rgba(0,0,0,0.8)', zIndex: 2000 }}>\r\n                    <form onSubmit={handlePostAssignment} className=\"glass-panel\" style={{ width: '400px', padding: '30px', display: 'flex', flexDirection: 'column', gap: '20px' }}>\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>\r\n                            <h2 style={{ margin: 0 }}>Create Assignment</h2>\r\n                            <X onClick={() => setShowAssignmentModal(false)} style={{ cursor: 'pointer' }} />\r\n                        </div>\r\n                        <input\r\n                            className=\"input-glass\"\r\n                            placeholder=\"Assignment Title\"\r\n                            required\r\n                            value={assignmentTitle}\r\n                            onChange={(e) => setAssignmentTitle(e.target.value)}\r\n                        />\r\n                        <div>\r\n                            <label style={{ fontSize: '0.8rem', display: 'block', marginBottom: '5px' }}>Due Date</label>\r\n                            <input\r\n                                type=\"date\"\r\n                                className=\"input-glass\"\r\n                                required\r\n                                value={assignmentDate}\r\n                                onChange={(e) => setAssignmentDate(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <button type=\"submit\" className=\"btn-glow\">Post Assignment</button>\r\n                    </form>\r\n                </div>\r\n            )}\r\n\r\n            {/* Note Modal */}\r\n            {showNoteModal && (\r\n                <div className=\"flex-center\" style={{ position: 'fixed', top: 0, left: 0, width: '100%', height: '100%', background: 'rgba(0,0,0,0.8)', zIndex: 2000 }}>\r\n                    <form onSubmit={handlePostNote} className=\"glass-panel\" style={{ width: '400px', padding: '30px', display: 'flex', flexDirection: 'column', gap: '20px' }}>\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>\r\n                            <h2 style={{ margin: 0 }}>Add Study Material</h2>\r\n                            <X onClick={() => setShowNoteModal(false)} style={{ cursor: 'pointer' }} />\r\n                        </div>\r\n                        <input\r\n                            className=\"input-glass\"\r\n                            placeholder=\"Title (e.g. Lecture 1 Notes)\"\r\n                            required\r\n                            value={noteTitle}\r\n                            onChange={(e) => setNoteTitle(e.target.value)}\r\n                        />\r\n                        <input\r\n                            className=\"input-glass\"\r\n                            placeholder=\"Resource Link (Drive, PDF, etc)\"\r\n                            required\r\n                            value={noteLink}\r\n                            onChange={(e) => setNoteLink(e.target.value)}\r\n                        />\r\n                        <button type=\"submit\" className=\"btn-glow\">Add Material</button>\r\n                    </form>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Classroom;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\pages\\Dashboard.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchDashboardData'. Either include it or remove the dependency array.","line":140,"column":8,"nodeType":"ArrayExpression","endLine":140,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [api, fetchDashboardData, user]","fix":{"range":[6688,6699],"text":"[api, fetchDashboardData, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { Link } from 'react-router-dom';\r\nimport AnalyticsCard from '../components/AnalyticsCard';\r\nimport OverallAttendanceBar from '../components/OverallAttendanceBar';\r\nimport {\r\n    Users, Book, ShieldCheck, Plus, FolderOpen,\r\n    Trash2, LogOut, TrendingUp\r\n} from 'lucide-react';\r\n\r\n/*  Helper: Stat Card  */\r\nconst StatCard = ({ icon, label, value, badge, badgeOk, accent }) => (\r\n    <div style={{\r\n        padding: '20px 22px',\r\n        background: 'rgba(10,14,28,0.6)',\r\n        border: `1px solid ${accent}22`,\r\n        borderRadius: '18px',\r\n        backdropFilter: 'blur(20px)',\r\n        boxShadow: '0 4px 20px rgba(0,0,0,0.35)',\r\n        position: 'relative', overflow: 'hidden'\r\n    }}>\r\n        <div style={{\r\n            position: 'absolute', top: 0, right: 0, width: '100px', height: '100px',\r\n            background: `radial-gradient(circle, ${accent}18 0%, transparent 70%)`,\r\n            borderRadius: '50%', transform: 'translate(30%, -30%)'\r\n        }} />\r\n        <div style={{\r\n            width: '34px', height: '34px', borderRadius: '10px',\r\n            background: `${accent}22`, border: `1px solid ${accent}33`,\r\n            display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n            color: accent, marginBottom: '12px'\r\n        }}>{icon}</div>\r\n        <p style={{ margin: '0 0 4px', fontSize: '0.7rem', fontWeight: 700, letterSpacing: '0.08em', textTransform: 'uppercase', color: 'rgba(255,255,255,0.4)' }}>{label}</p>\r\n        <p style={{ margin: '0 0 10px', fontSize: '2rem', fontWeight: '900', color: 'white', lineHeight: 1 }}>{value}</p>\r\n        <span style={{\r\n            fontSize: '0.72rem', fontWeight: 700, padding: '3px 10px', borderRadius: '100px',\r\n            background: badgeOk ? 'rgba(16,185,129,0.12)' : 'rgba(239,68,68,0.12)',\r\n            color: badgeOk ? '#34d399' : '#f87171',\r\n            border: `1px solid ${badgeOk ? 'rgba(16,185,129,0.25)' : 'rgba(239,68,68,0.25)'}`\r\n        }}>{badge}</span>\r\n    </div>\r\n);\r\n\r\n/*  Helper: Section Header  */\r\nconst SectionHeader = ({ icon, title, badge, noMargin }) => (\r\n    <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: noMargin ? 0 : '18px' }}>\r\n        <div style={{ color: 'rgba(255,255,255,0.5)', display: 'flex' }}>{icon}</div>\r\n        <h3 style={{ margin: 0, fontSize: '1rem', fontWeight: 700, color: 'rgba(255,255,255,0.85)' }}>{title}</h3>\r\n        {badge && (\r\n            <span style={{\r\n                fontSize: '0.68rem', fontWeight: 700, padding: '2px 8px', borderRadius: '100px',\r\n                background: 'rgba(99,102,241,0.15)', color: '#818cf8', border: '1px solid rgba(99,102,241,0.2)'\r\n            }}>{badge}</span>\r\n        )}\r\n    </div>\r\n);\r\n\r\n/*  Main Dashboard Component  */\r\nconst Dashboard = () => {\r\n    const { user, api } = useAuth();\r\n    const [classes, setClasses] = useState([]);\r\n    const [attendanceTrend, setAttendanceTrend] = useState([]);\r\n    const [participationStats, setParticipationStats] = useState([]);\r\n    const [radarData, setRadarData] = useState([]);\r\n    const [faceDetectionData, setFaceDetectionData] = useState([]);\r\n    const [insights, setInsights] = useState([]);\r\n    const [stats, setStats] = useState({ primaryStat: '0', avgAttendance: '0', trend: '0', statusMessage: '' });\r\n    const [loading, setLoading] = useState(true);\r\n    const [showJoinModal, setShowJoinModal] = useState(false);\r\n    const [showCreateModal, setShowCreateModal] = useState(false);\r\n    const [classCode, setClassCode] = useState('');\r\n    const [newClassName, setNewClassName] = useState('');\r\n    const [newSubjectName, setNewSubjectName] = useState('');\r\n    const [subjectNameEdited, setSubjectNameEdited] = useState(false);\r\n\r\n    const fetchDashboardData = async () => {\r\n        try {\r\n            const calls = [\r\n                api.get('/classes/my'),                        // 0\r\n                api.get('/classes/analytics/attendance'),      // 1\r\n                api.get('/classes/analytics/participation'),   // 2\r\n                api.get('/classes/summary'),                   // 3\r\n                api.get('/classes/analytics/insights'),        // 4\r\n                api.get('/classes/analytics/radar'),           // 5\r\n            ];\r\n            if (user?.role === 'professor') {\r\n                calls.push(api.get('/classes/analytics/face-detection')); // 6\r\n            }\r\n\r\n            // Use allSettled so one failure doesn't block the whole dashboard\r\n            const results = await Promise.allSettled(calls);\r\n\r\n            const ok = (r) => r.status === 'fulfilled' ? r.value.data : null;\r\n            const warn = (r, label) => {\r\n                if (r.status === 'rejected') console.warn(`[Dashboard] ${label} failed:`, r.reason?.message || r.reason);\r\n            };\r\n\r\n            warn(results[0], 'my-classes');\r\n            warn(results[1], 'attendance-trend');\r\n            warn(results[2], 'participation');\r\n            warn(results[3], 'summary');\r\n            warn(results[4], 'insights');\r\n            warn(results[5], 'radar');\r\n\r\n            if (ok(results[0])) setClasses(ok(results[0]));\r\n            if (ok(results[1])) setAttendanceTrend(ok(results[1]));\r\n            if (ok(results[2])) setParticipationStats(ok(results[2]));\r\n            if (ok(results[3])) setStats(ok(results[3]));\r\n            if (ok(results[4])) setInsights(ok(results[4]));\r\n            if (ok(results[5])) setRadarData(ok(results[5]));\r\n            if (user?.role === 'professor' && results[6]) {\r\n                if (ok(results[6])) setFaceDetectionData(ok(results[6]));\r\n                warn(results[6], 'face-detection');\r\n            }\r\n        } catch (err) {\r\n            console.error('Fatal dashboard fetch error:', err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n\r\n    const handleLeaveClass = async (classId, className) => {\r\n        if (window.confirm(`Leave ${className}?`)) {\r\n            try { await api.post(`/classes/${classId}/leave`); fetchDashboardData(); }\r\n            catch { alert('Failed to leave class'); }\r\n        }\r\n    };\r\n\r\n    const handleDeleteClass = async (classId, className) => {\r\n        if (window.confirm(`Delete ${className}? All attendance data will be lost permanently.`)) {\r\n            try { await api.delete(`/classes/${classId}`); fetchDashboardData(); }\r\n            catch { alert('Failed to delete class'); }\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        const authLoading = localStorage.getItem('token') && !user;\r\n        if (!authLoading) fetchDashboardData();\r\n    }, [api, user]);\r\n\r\n    const handleJoinClass = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            await api.post('/classes/join', { code: classCode });\r\n            setShowJoinModal(false); setClassCode('');\r\n            fetchDashboardData();\r\n        } catch (err) { alert(err.response?.data?.msg || 'Error joining class'); }\r\n    };\r\n\r\n    const handleCreateClass = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            const code = Math.random().toString(36).substring(2, 8).toUpperCase();\r\n            await api.post('/classes/create', {\r\n                name: newClassName,\r\n                subjectName: newSubjectName || newClassName,\r\n                code\r\n            });\r\n            setShowCreateModal(false);\r\n            setNewClassName('');\r\n            setNewSubjectName('');\r\n            setSubjectNameEdited(false);\r\n            fetchDashboardData();\r\n        } catch (err) { alert(err.response?.data?.msg || 'Error creating class'); }\r\n    };\r\n\r\n    if (loading) return (\r\n        <div className=\"flex-center\" style={{ height: '80vh' }}>\r\n            <div className=\"loader\" />\r\n        </div>\r\n    );\r\n\r\n    const insightColor = (type) => type === 'critical' ? '#f87171' : type === 'warning' ? '#fbbf24' : '#34d399';\r\n    const insightBorderColor = (type) => type === 'critical' ? '#ef4444' : type === 'warning' ? '#f59e0b' : '#10b981';\r\n\r\n    return (\r\n        <div className=\"content-wrapper fade-in\" style={{ padding: '36px 24px 60px', maxWidth: '1280px', margin: '0 auto' }}>\r\n\r\n            {/*  Header  */}\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '14px', marginBottom: '32px' }}>\r\n                <div style={{\r\n                    width: '44px', height: '44px', borderRadius: '13px',\r\n                    background: 'linear-gradient(135deg, #6366f1, #a855f7)',\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                    boxShadow: '0 8px 24px rgba(99,102,241,0.4)', flexShrink: 0\r\n                }}>\r\n                    <TrendingUp size={20} color=\"white\" />\r\n                </div>\r\n                <div>\r\n                    <h1 style={{ fontSize: '1.85rem', fontWeight: '800', margin: 0 }}>\r\n                        Welcome, <span className=\"text-gradient\">{user?.name}</span>\r\n                    </h1>\r\n                    <p style={{ margin: 0, fontSize: '0.8rem', color: 'rgba(255,255,255,0.4)', fontWeight: 500 }}>\r\n                        {user?.institutionId?.name || 'Smart Classroom Platform'}  {user?.role?.charAt(0).toUpperCase() + user?.role?.slice(1)}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/*  Stat Cards  */}\r\n            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(220px, 1fr))', gap: '18px', marginBottom: '30px' }}>\r\n                <StatCard\r\n                    icon={<TrendingUp size={18} />}\r\n                    label={user?.role === 'professor' ? 'Total Students' : 'Overall Attendance'}\r\n                    value={user?.role === 'student' ? `${stats.primaryStat}%` : stats.primaryStat}\r\n                    badge={`${parseFloat(stats.trend) >= 0 ? '+' : ''}${stats.trend}% vs last week`}\r\n                    badgeOk={parseFloat(stats.trend) >= 0}\r\n                    accent=\"#6366f1\"\r\n                />\r\n                <StatCard\r\n                    icon={<Book size={18} />}\r\n                    label=\"My Classes\"\r\n                    value={classes.length}\r\n                    badge={`${classes.length} enrolled`}\r\n                    badgeOk={true}\r\n                    accent=\"#06b6d4\"\r\n                />\r\n                {user?.role === 'professor' ? (\r\n                    <StatCard\r\n                        icon={<Users size={18} />}\r\n                        label=\"Avg Class Attendance\"\r\n                        value={`${stats.avgAttendance || 0}%`}\r\n                        badge={parseFloat(stats.avgAttendance) >= 75 ? 'Above threshold' : 'Below threshold'}\r\n                        badgeOk={parseFloat(stats.avgAttendance) >= 75}\r\n                        accent=\"#10b981\"\r\n                    />\r\n                ) : (\r\n                    <div style={{\r\n                        padding: '20px 22px',\r\n                        background: 'rgba(10,14,28,0.6)',\r\n                        border: user?.isFaceRegistered ? '1px solid rgba(16,185,129,0.2)' : '1px solid rgba(239,68,68,0.2)',\r\n                        borderRadius: '18px', backdropFilter: 'blur(20px)',\r\n                        boxShadow: '0 4px 20px rgba(0,0,0,0.35)', position: 'relative', overflow: 'hidden'\r\n                    }}>\r\n                        <div style={{\r\n                            position: 'absolute', top: 0, right: 0, width: '80px', height: '80px',\r\n                            background: `radial-gradient(circle, ${user?.isFaceRegistered ? 'rgba(16,185,129,0.15)' : 'rgba(239,68,68,0.15)'} 0%, transparent 70%)`,\r\n                            borderRadius: '50%', transform: 'translate(20%, -20%)'\r\n                        }} />\r\n                        <p style={{ margin: '0 0 10px', fontSize: '0.7rem', fontWeight: 700, letterSpacing: '0.08em', textTransform: 'uppercase', color: 'rgba(255,255,255,0.4)' }}>Face ID Status</p>\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '14px' }}>\r\n                            <div style={{\r\n                                width: '10px', height: '10px', borderRadius: '50%',\r\n                                background: user?.isFaceRegistered ? '#10b981' : '#ef4444',\r\n                                boxShadow: `0 0 12px ${user?.isFaceRegistered ? '#10b981' : '#ef4444'}`\r\n                            }} />\r\n                            <span style={{ fontWeight: 700, fontSize: '1rem' }}>{user?.isFaceRegistered ? 'Verified' : 'Not Registered'}</span>\r\n                        </div>\r\n                        {!user?.isFaceRegistered && (\r\n                            <Link to=\"/face-register\" className=\"btn-glow\" style={{ display: 'block', textAlign: 'center', padding: '8px', fontSize: '0.8rem' }}>Setup Face ID </Link>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/*  Overall Attendance Bar (Student)  */}\r\n            {user?.role === 'student' && (\r\n                <OverallAttendanceBar percentage={stats.primaryStat} message={stats.statusMessage} />\r\n            )}\r\n\r\n            {/*  Analytics  */}\r\n            <SectionHeader icon={<TrendingUp size={16} />} title=\"Analytics\" badge=\"Live Data\" />\r\n\r\n            {user?.role === 'student' ? (\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(380px, 1fr))', gap: '20px', marginBottom: '36px' }}>\r\n                    <div style={{ gridColumn: '1 / -1' }}>\r\n                        <AnalyticsCard\r\n                            title=\"Subject-Wise Attendance\"\r\n                            subtitle=\"Classes attended vs total classes happened per subject\"\r\n                            type=\"horizontalBar\"\r\n                            data={participationStats}\r\n                        />\r\n                    </div>\r\n                    <AnalyticsCard\r\n                        title=\"Attendance Trend (14 days)\"\r\n                        subtitle=\"Your daily attendance rate vs university average\"\r\n                        type=\"composed\"\r\n                        data={attendanceTrend}\r\n                    />\r\n                    {radarData?.length > 0 && (\r\n                        <AnalyticsCard\r\n                            title=\"Performance Radar\"\r\n                            subtitle=\"Attendance spread across all subjects\"\r\n                            type=\"radar\"\r\n                            data={radarData}\r\n                        />\r\n                    )}\r\n                </div>\r\n            ) : (\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(380px, 1fr))', gap: '20px', marginBottom: '36px' }}>\r\n                    <AnalyticsCard\r\n                        title=\"Class Attendance Trend\"\r\n                        subtitle=\"Average attendance rate across all your classes (14 days)\"\r\n                        type=\"composed\"\r\n                        data={attendanceTrend}\r\n                    />\r\n                    <AnalyticsCard\r\n                        title=\"Face Detection Quality\"\r\n                        subtitle=\"Breakdown of face recognition outcomes in sessions\"\r\n                        type=\"faceDetection\"\r\n                        data={faceDetectionData}\r\n                    />\r\n                    {radarData?.length > 0 && (\r\n                        <div style={{ gridColumn: '1 / -1' }}>\r\n                            <AnalyticsCard\r\n                                title=\"Participation by Subject\"\r\n                                subtitle=\"Attendance distribution across all classes\"\r\n                                type=\"radar\"\r\n                                data={radarData}\r\n                            />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/*  Smart Insights  */}\r\n            {insights?.length > 0 && (\r\n                <div style={{ marginBottom: '36px' }}>\r\n                    <SectionHeader icon={<ShieldCheck size={16} />} title=\"Smart Insights\" badge={`${insights.length} alerts`} />\r\n                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '14px' }}>\r\n                        {insights.map((insight, idx) => (\r\n                            <div key={idx} style={{\r\n                                padding: '18px 20px',\r\n                                background: 'rgba(10,14,28,0.55)',\r\n                                borderRadius: '16px', backdropFilter: 'blur(20px)',\r\n                                border: '1px solid rgba(255,255,255,0.05)',\r\n                                borderLeft: `3px solid ${insightBorderColor(insight.type)}`,\r\n                            }}>\r\n                                <h4 style={{ margin: '0 0 4px', fontSize: '0.88rem', color: insightColor(insight.type) }}>\r\n                                    {insight.title}\r\n                                </h4>\r\n                                <p style={{ margin: 0, fontSize: '0.82rem', color: 'rgba(255,255,255,0.55)' }}>{insight.message}</p>\r\n                                {insight.data && (\r\n                                    <div style={{ marginTop: '12px' }}>\r\n                                        {insight.data.map((item, id) => (\r\n                                            <div key={id} style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.78rem', padding: '4px 0', borderBottom: '1px solid rgba(255,255,255,0.04)' }}>\r\n                                                <span style={{ color: 'rgba(255,255,255,0.7)' }}>{item.name}</span>\r\n                                                <span style={{ color: 'rgba(255,255,255,0.35)' }}>{item.universityRollNo}</span>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/*  My Classes  */}\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>\r\n                <SectionHeader icon={<Book size={16} />} title=\"My Classes\" badge={`${classes.length} total`} noMargin />\r\n                {user?.role === 'professor' ? (\r\n                    <button className=\"btn-glow\" onClick={() => setShowCreateModal(true)} style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                        <Plus size={16} /> Create Class\r\n                    </button>\r\n                ) : (\r\n                    <button className=\"btn-glow\" onClick={() => setShowJoinModal(true)} style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                        <Plus size={16} /> Join Class\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {classes.length === 0 ? (\r\n                <div className=\"glass-panel flex-center\" style={{ padding: '60px', flexDirection: 'column', gap: '16px', background: 'rgba(10,14,28,0.4)' }}>\r\n                    <FolderOpen size={44} style={{ opacity: 0.2 }} />\r\n                    <p style={{ margin: 0, color: 'rgba(255,255,255,0.4)' }}>No classes yet. Get started!</p>\r\n                </div>\r\n            ) : (\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))', gap: '20px' }}>\r\n                    {classes.map((cls) => (\r\n                        <Link to={`/classroom/${cls.code}`} key={cls._id} style={{\r\n                            display: 'block', textDecoration: 'none', color: 'inherit',\r\n                            background: 'rgba(10,14,28,0.6)',\r\n                            border: '1px solid rgba(255,255,255,0.06)',\r\n                            borderRadius: '20px', overflow: 'hidden',\r\n                            backdropFilter: 'blur(20px)',\r\n                            boxShadow: '0 4px 20px rgba(0,0,0,0.3)',\r\n                            transition: 'transform 0.2s ease, box-shadow 0.2s ease',\r\n                        }}\r\n                            onMouseEnter={e => { e.currentTarget.style.transform = 'translateY(-4px)'; e.currentTarget.style.boxShadow = '0 12px 40px rgba(99,102,241,0.25)'; }}\r\n                            onMouseLeave={e => { e.currentTarget.style.transform = 'translateY(0)'; e.currentTarget.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)'; }}\r\n                        >\r\n                            <div style={{\r\n                                height: '88px', position: 'relative',\r\n                                background: `linear-gradient(135deg, hsl(${(cls.code?.charCodeAt(0) * 7) % 360}, 55%, 28%), hsl(${(cls.code?.charCodeAt(0) * 13) % 360}, 65%, 18%))`,\r\n                            }}>\r\n                                <div style={{ position: 'absolute', inset: 0, background: 'linear-gradient(to bottom, transparent 40%, rgba(10,14,28,0.92) 100%)' }} />\r\n                                <span style={{\r\n                                    position: 'absolute', bottom: '10px', right: '14px',\r\n                                    background: 'rgba(0,0,0,0.5)', backdropFilter: 'blur(8px)',\r\n                                    padding: '3px 10px', borderRadius: '100px',\r\n                                    fontSize: '0.7rem', fontWeight: 700, letterSpacing: '0.05em', color: 'white'\r\n                                }}>#{cls.code}</span>\r\n                            </div>\r\n                            <div style={{ padding: '14px 18px 18px' }}>\r\n                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' }}>\r\n                                    <div style={{ flex: 1, minWidth: 0 }}>\r\n                                        <h3 style={{ margin: '0 0 3px', fontSize: '1rem', fontWeight: 700, whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{cls.name}</h3>\r\n                                        <p style={{ margin: 0, fontSize: '0.73rem', color: 'rgba(255,255,255,0.4)' }}>Prof. {cls.professorName || 'Dr. Sharma'}</p>\r\n                                    </div>\r\n                                    {user?.role === 'professor' ? (\r\n                                        <button onClick={(e) => { e.preventDefault(); e.stopPropagation(); handleDeleteClass(cls._id, cls.name); }}\r\n                                            style={{ padding: '7px', borderRadius: '10px', background: 'rgba(239,68,68,0.1)', color: '#f87171', border: '1px solid rgba(239,68,68,0.2)', cursor: 'pointer', flexShrink: 0 }}\r\n                                        ><Trash2 size={14} /></button>\r\n                                    ) : (\r\n                                        <button onClick={(e) => { e.preventDefault(); e.stopPropagation(); handleLeaveClass(cls._id, cls.name); }}\r\n                                            style={{ padding: '7px', borderRadius: '10px', background: 'rgba(255,255,255,0.06)', color: 'rgba(255,255,255,0.4)', border: '1px solid rgba(255,255,255,0.08)', cursor: 'pointer', flexShrink: 0 }}\r\n                                        ><LogOut size={14} /></button>\r\n                                    )}\r\n                                </div>\r\n                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                        <Users size={12} color=\"rgba(99,102,241,0.7)\" />\r\n                                        <span style={{ fontSize: '0.73rem', color: 'rgba(255,255,255,0.45)' }}>{cls.students?.length || 0} students</span>\r\n                                    </div>\r\n                                    <span style={{\r\n                                        fontSize: '0.68rem', fontWeight: 700, letterSpacing: '0.06em',\r\n                                        padding: '4px 12px', borderRadius: '100px',\r\n                                        background: 'rgba(99,102,241,0.14)', color: '#818cf8',\r\n                                        border: '1px solid rgba(99,102,241,0.22)'\r\n                                    }}>ENTER </span>\r\n                                </div>\r\n                            </div>\r\n                        </Link>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/*  Join Modal  */}\r\n            {showJoinModal && (\r\n                <div className=\"flex-center\" style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.82)', zIndex: 2000, backdropFilter: 'blur(6px)' }}>\r\n                    <div className=\"glass-panel\" style={{ padding: '36px', maxWidth: '380px', width: '92%', borderRadius: '24px' }}>\r\n                        <h2 style={{ marginTop: 0 }}>Join a Class</h2>\r\n                        <p className=\"text-muted\" style={{ marginBottom: '20px', fontSize: '0.88rem' }}>Enter the 6-character class code from your professor.</p>\r\n                        <form onSubmit={handleJoinClass}>\r\n                            <input type=\"text\" className=\"input-glass\" placeholder=\"e.g. AB12CD\"\r\n                                value={classCode} onChange={(e) => setClassCode(e.target.value)}\r\n                                required maxLength=\"6\" style={{ textAlign: 'center', letterSpacing: '6px', fontSize: '1.5rem', marginBottom: '18px' }} />\r\n                            <div style={{ display: 'flex', gap: '10px' }}>\r\n                                <button type=\"button\" className=\"btn-glow btn-outline\" onClick={() => setShowJoinModal(false)} style={{ flex: 1 }}>Cancel</button>\r\n                                <button type=\"submit\" className=\"btn-glow\" style={{ flex: 1 }}>Join </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/*  Create Modal  */}\r\n            {showCreateModal && (\r\n                <div className=\"flex-center\" style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.82)', zIndex: 2000, backdropFilter: 'blur(6px)' }}>\r\n                    <div className=\"glass-panel\" style={{ padding: '36px', maxWidth: '380px', width: '92%', borderRadius: '24px' }}>\r\n                        <h2 style={{ marginTop: 0 }}>Create Class</h2>\r\n                        <p className=\"text-muted\" style={{ marginBottom: '20px', fontSize: '0.88rem' }}>Give your new classroom a name. A unique code will be auto-generated.</p>\r\n                        <form onSubmit={handleCreateClass}>\r\n                            <label style={{ display: 'block', fontSize: '0.75rem', fontWeight: 700, color: 'rgba(255,255,255,0.45)', letterSpacing: '0.07em', textTransform: 'uppercase', marginBottom: '6px' }}>Class / Course Code</label>\r\n                            <input type=\"text\" className=\"input-glass\" placeholder=\"e.g. CS301 - Data Structures\"\r\n                                value={newClassName}\r\n                                onChange={(e) => {\r\n                                    setNewClassName(e.target.value);\r\n                                    if (!subjectNameEdited) setNewSubjectName(e.target.value);\r\n                                }}\r\n                                required style={{ marginBottom: '14px' }} />\r\n                            <label style={{ display: 'block', fontSize: '0.75rem', fontWeight: 700, color: 'rgba(255,255,255,0.45)', letterSpacing: '0.07em', textTransform: 'uppercase', marginBottom: '6px' }}>Subject Name <span style={{ color: 'rgba(255,255,255,0.25)', fontWeight: 500, textTransform: 'none' }}>(shown in charts)</span></label>\r\n                            <input type=\"text\" className=\"input-glass\" placeholder=\"e.g. Data Structures\"\r\n                                value={newSubjectName}\r\n                                onChange={(e) => { setSubjectNameEdited(true); setNewSubjectName(e.target.value); }}\r\n                                style={{ marginBottom: '18px' }} />\r\n                            <div style={{ display: 'flex', gap: '10px' }}>\r\n                                <button type=\"button\" className=\"btn-glow btn-outline\" onClick={() => { setShowCreateModal(false); setNewClassName(''); setNewSubjectName(''); setSubjectNameEdited(false); }} style={{ flex: 1 }}>Cancel</button>\r\n                                <button type=\"submit\" className=\"btn-glow\" style={{ flex: 1 }}>Create </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <style>{`@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }`}</style>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Dashboard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\pages\\FaceRegister.jsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`startVideo` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\n  22 |                 ]);\n  23 |                 setModelLoaded(true);\n> 24 |                 startVideo();\n     |                 ^^^^^^^^^^ `startVideo` accessed before it is declared\n  25 |             } catch (err) {\n  26 |                 console.error(\"Failed to load models:\", err);\n  27 |                 alert(\"Failed to load AI models. Please check your internet connection.\");\n\n  31 |     }, []);\n  32 |\n> 33 |     const startVideo = () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 34 |         navigator.mediaDevices.getUserMedia({ video: {} })\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 35 |             .then(stream => {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 36 |                 videoRef.current.srcObject = stream;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 37 |             })\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 38 |             .catch(err => console.error(err));\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 39 |     };\n     | ^^^^^^^ `startVideo` is declared here\n  40 |\n  41 |     const handleVideoPlay = () => {\n  42 |         setInterval(async () => {","line":24,"column":17,"nodeType":null,"endLine":24,"endColumn":27},{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":74,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":74,"endColumn":25}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect } from 'react';\r\nimport * as faceapi from 'face-api.js';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst FaceRegister = () => {\r\n    const videoRef = useRef();\r\n    const canvasRef = useRef();\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [modelLoaded, setModelLoaded] = useState(false);\r\n    const { api } = useAuth();\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        const loadModels = async () => {\r\n            try {\r\n                const MODEL_URL = 'https://justadudewhohacks.github.io/face-api.js/models';\r\n                await Promise.all([\r\n                    faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL),\r\n                    faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n                    faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)\r\n                ]);\r\n                setModelLoaded(true);\r\n                startVideo();\r\n            } catch (err) {\r\n                console.error(\"Failed to load models:\", err);\r\n                alert(\"Failed to load AI models. Please check your internet connection.\");\r\n            }\r\n        };\r\n        loadModels();\r\n    }, []);\r\n\r\n    const startVideo = () => {\r\n        navigator.mediaDevices.getUserMedia({ video: {} })\r\n            .then(stream => {\r\n                videoRef.current.srcObject = stream;\r\n            })\r\n            .catch(err => console.error(err));\r\n    };\r\n\r\n    const handleVideoPlay = () => {\r\n        setInterval(async () => {\r\n            if (canvasRef.current && videoRef.current) {\r\n                const displaySize = { width: videoRef.current.width, height: videoRef.current.height };\r\n                faceapi.matchDimensions(canvasRef.current, displaySize);\r\n\r\n                const detections = await faceapi.detectSingleFace(videoRef.current, new faceapi.SsdMobilenetv1Options({ minConfidence: 0.5 }))\r\n                    .withFaceLandmarks();\r\n\r\n                const ctx = canvasRef.current.getContext('2d');\r\n                ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n\r\n                if (detections) {\r\n                    const resizedDetections = faceapi.resizeResults(detections, displaySize);\r\n                    faceapi.draw.drawDetections(canvasRef.current, resizedDetections);\r\n                    faceapi.draw.drawFaceLandmarks(canvasRef.current, resizedDetections);\r\n                }\r\n            }\r\n        }, 100);\r\n    };\r\n\r\n    const capture = async () => {\r\n        setIsLoading(true);\r\n        const detections = await faceapi.detectSingleFace(videoRef.current, new faceapi.SsdMobilenetv1Options({ minConfidence: 0.5 }))\r\n            .withFaceLandmarks()\r\n            .withFaceDescriptor();\r\n\r\n        if (detections) {\r\n            const descriptor = Array.from(detections.descriptor);\r\n            try {\r\n                await api.post('/classes/face/register', { descriptor });\r\n                alert('Face Registered Successfully!');\r\n                navigate('/dashboard');\r\n            } catch (err) {\r\n                alert('Failed to save face data.');\r\n            }\r\n        } else {\r\n            alert('No face detected. Please try again.');\r\n        }\r\n        setIsLoading(false);\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex-center\" style={{ minHeight: '100vh', flexDirection: 'column' }}>\r\n            <h2 className=\"text-gradient\" style={{ marginBottom: '20px' }}>Setup Face ID</h2>\r\n            <div className=\"glass-panel\" style={{ padding: '10px', borderRadius: '20px', overflow: 'hidden', position: 'relative' }}>\r\n                <video\r\n                    ref={videoRef}\r\n                    autoPlay\r\n                    muted\r\n                    width=\"640\"\r\n                    height=\"480\"\r\n                    onPlay={handleVideoPlay}\r\n                    style={{ borderRadius: '15px' }}\r\n                />\r\n                <canvas ref={canvasRef} style={{ position: 'absolute', top: '10px', left: '10px' }} />\r\n            </div>\r\n            <div style={{ marginTop: '20px' }}>\r\n                {!modelLoaded ? (\r\n                    <p className=\"text-muted\">Loading AI Models...</p>\r\n                ) : (\r\n                    <button onClick={capture} disabled={isLoading} className=\"btn-glow\">\r\n                        {isLoading ? 'Scanning...' : 'Capture & Save'}\r\n                    </button>\r\n                )}\r\n            </div>\r\n            <button onClick={() => navigate('/dashboard')} className=\"btn-outline\" style={{ marginTop: '20px' }}>Back</button>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default FaceRegister;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\pages\\Login.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":22,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":25},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: This value cannot be modified\n\nModifying a value returned from a hook is not allowed. Consider moving the modification into the hook where the value is constructed.\n\n  49 |             const res = await api.post('/auth/google', { token: credentialResponse.credential });\n  50 |             localStorage.setItem('token', res.data.token);\n> 51 |             api.defaults.headers.common['x-auth-token'] = res.data.token;\n     |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^ `api` cannot be modified\n  52 |             // Force reload to update context state since we bypassed login() method\n  53 |             window.location.href = '/dashboard';\n  54 |         } catch (err) {","line":51,"column":13,"nodeType":null,"endLine":51,"endColumn":40}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { GoogleLogin } from '@react-oauth/google';\r\n\r\nconst Login = () => {\r\n    const [isLogin, setIsLogin] = useState(true);\r\n    const [formData, setFormData] = useState({ name: '', email: '', password: '', role: 'student', key: '', institutionId: '' });\r\n    const { login, register, api } = useAuth();\r\n    const navigate = useNavigate();\r\n    const [institutions, setInstitutions] = useState([]);\r\n\r\n    // Fetch institutions\r\n    useState(() => {\r\n        const fetchInstitutions = async () => {\r\n            try {\r\n                const res = await api.get('/institutions/all');\r\n                setInstitutions(res.data);\r\n                if (res.data.length > 0) {\r\n                    setFormData(prev => ({ ...prev, institutionId: res.data[0]._id }));\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Failed to load institutions\");\r\n            }\r\n        };\r\n        fetchInstitutions();\r\n    }, []);\r\n\r\n    const onChange = e => setFormData({ ...formData, [e.target.name]: e.target.value });\r\n\r\n    const onSubmit = async e => {\r\n        e.preventDefault();\r\n        try {\r\n            if (isLogin) {\r\n                await login(formData.email, formData.password);\r\n            } else {\r\n                await register(formData);\r\n            }\r\n            navigate('/dashboard');\r\n        } catch (err) {\r\n            console.error(\"Full Login Error:\", err);\r\n            const errorMsg = err.response?.data?.msg || err.message || 'Unknown Error';\r\n            alert('Login Failed: ' + errorMsg);\r\n        }\r\n    };\r\n\r\n    const googleSuccess = async (credentialResponse) => {\r\n        try {\r\n            const res = await api.post('/auth/google', { token: credentialResponse.credential });\r\n            localStorage.setItem('token', res.data.token);\r\n            api.defaults.headers.common['x-auth-token'] = res.data.token;\r\n            // Force reload to update context state since we bypassed login() method\r\n            window.location.href = '/dashboard';\r\n        } catch (err) {\r\n            console.error(err);\r\n            alert('Google Login Failed');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex-center\" style={{ minHeight: '100vh' }}>\r\n            <div className=\"glass-panel\" style={{ padding: '40px', width: '100%', maxWidth: '400px' }}>\r\n                <h2 className=\"text-gradient\" style={{ textAlign: 'center', marginBottom: '20px' }}>\r\n                    {isLogin ? 'Welcome Back' : 'Join Us'}\r\n                </h2>\r\n\r\n                <div style={{ display: 'flex', justifyContent: 'center', marginBottom: '20px' }}>\r\n                    <GoogleLogin\r\n                        onSuccess={googleSuccess}\r\n                        onError={() => {\r\n                            console.log('Login Failed');\r\n                        }}\r\n                        theme=\"filled_black\"\r\n                        shape=\"pill\"\r\n                    />\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', alignItems: 'center', margin: '20px 0' }}>\r\n                    <div style={{ flex: 1, height: '1px', background: 'var(--glass-border)' }}></div>\r\n                    <span style={{ padding: '0 10px', color: 'var(--text-muted)' }}>OR</span>\r\n                    <div style={{ flex: 1, height: '1px', background: 'var(--glass-border)' }}></div>\r\n                </div>\r\n\r\n                <form onSubmit={onSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '15px' }}>\r\n                    {!isLogin && (\r\n                        <input type=\"text\" name=\"name\" placeholder=\"Full Name\" className=\"input-glass\" onChange={onChange} required />\r\n                    )}\r\n\r\n                    <input type=\"email\" name=\"email\" placeholder=\"Email Address\" className=\"input-glass\" onChange={onChange} required />\r\n                    <input type=\"password\" name=\"password\" placeholder=\"Password\" className=\"input-glass\" onChange={onChange} required />\r\n\r\n                    {!isLogin && (\r\n                        <select name=\"role\" className=\"input-glass\" onChange={onChange} value={formData.role}>\r\n                            <option value=\"student\" style={{ color: 'black' }}>Student</option>\r\n                            <option value=\"professor\" style={{ color: 'black' }}>Professor</option>\r\n                        </select>\r\n                    )}\r\n\r\n                    {!isLogin && (\r\n                        <select name=\"institutionId\" className=\"input-glass\" onChange={onChange} value={formData.institutionId} required>\r\n                            <option value=\"\" disabled style={{ color: 'black' }}>Select Institution</option>\r\n                            {institutions.map(inst => (\r\n                                <option key={inst._id} value={inst._id} style={{ color: 'black' }}>{inst.name} ({inst.code})</option>\r\n                            ))}\r\n                        </select>\r\n                    )}\r\n\r\n                    {!isLogin && formData.role === 'professor' && (\r\n                        <input type=\"password\" name=\"key\" placeholder=\"Professor Key (admin123)\" className=\"input-glass\" onChange={onChange} />\r\n                    )}\r\n\r\n                    <button type=\"submit\" className=\"btn-glow\">{isLogin ? 'Login' : 'Register'}</button>\r\n                </form>\r\n\r\n                <p style={{ marginTop: '20px', textAlign: 'center', fontSize: '0.9rem', color: 'var(--text-muted)' }}>\r\n                    {isLogin ? \"Don't have an account? \" : \"Already have an account? \"}\r\n                    <span style={{ color: 'var(--accent-primary)', cursor: 'pointer', fontWeight: 'bold' }} onClick={() => setIsLogin(!isLogin)}>\r\n                        {isLogin ? 'Sign Up' : 'Login'}\r\n                    </span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Login;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\pages\\Notifications.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchNotifications'. Either include it or remove the dependency array.","line":29,"column":8,"nodeType":"ArrayExpression","endLine":29,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNotifications, user]","fix":{"range":[751,757],"text":"[fetchNotifications, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n    Bell,\r\n    CheckCircle,\r\n    Info,\r\n    AlertCircle,\r\n    Trash2,\r\n    CheckCheck,\r\n    ChevronRight,\r\n    Search,\r\n    Filter,\r\n    BookOpen\r\n} from 'lucide-react';\r\n\r\nconst Notifications = () => {\r\n    const { user, api } = useAuth();\r\n    const navigate = useNavigate();\r\n    const [notifications, setNotifications] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [filter, setFilter] = useState('all');\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            fetchNotifications();\r\n        }\r\n    }, [user]);\r\n\r\n    const fetchNotifications = async () => {\r\n        try {\r\n            const res = await api.get('/notifications');\r\n            setNotifications(res.data);\r\n        } catch (err) {\r\n            console.error('Error fetching notifications:', err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const markAsRead = async (id) => {\r\n        try {\r\n            await api.put(`/notifications/${id}/read`);\r\n            setNotifications(notifications.map(n => n._id === id ? { ...n, isRead: true } : n));\r\n        } catch (err) {\r\n            console.error('Error marking read:', err);\r\n        }\r\n    };\r\n\r\n    const markAllRead = async () => {\r\n        try {\r\n            await api.put('/notifications/read-all');\r\n            setNotifications(notifications.map(n => ({ ...n, isRead: true })));\r\n        } catch (err) {\r\n            console.error('Error marking all read:', err);\r\n        }\r\n    };\r\n\r\n    const deleteNotification = async (id, e) => {\r\n        e.stopPropagation();\r\n        try {\r\n            await api.delete(`/notifications/${id}`);\r\n            setNotifications(notifications.filter(n => n._id !== id));\r\n        } catch (err) {\r\n            console.error('Error deleting notification:', err);\r\n        }\r\n    };\r\n\r\n    const getIcon = (type) => {\r\n        switch (type) {\r\n            case 'attendance': return <CheckCircle size={20} className=\"text-success\" />;\r\n            case 'absence': return <AlertCircle size={20} className=\"text-critical\" />;\r\n            case 'class': return <BookOpen size={20} className=\"text-warning\" />;\r\n            default: return <Info size={20} className=\"text-primary\" />;\r\n        }\r\n    };\r\n\r\n    const filteredNotifications = notifications.filter(n => {\r\n        const matchesFilter = filter === 'all' || n.type === filter;\r\n        const matchesSearch = n.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            n.message.toLowerCase().includes(searchTerm.toLowerCase());\r\n        return matchesFilter && matchesSearch;\r\n    });\r\n\r\n    const unreadCount = notifications.filter(n => !n.isRead).length;\r\n\r\n    if (loading) return <div className=\"flex-center\" style={{ height: '80vh' }}><div className=\"loader\"></div></div>;\r\n\r\n    return (\r\n        <div className=\"content-wrapper fade-in\" style={{ padding: '60px 20px', maxWidth: '1000px', margin: '0 auto' }}>\r\n\r\n            {/* Header Section */}\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-end', marginBottom: '50px' }}>\r\n                <div>\r\n                    <h1 style={{ fontSize: '3.5rem', fontWeight: '900', marginBottom: '10px', letterSpacing: '-1px', color: 'white' }}>\r\n                        Notifications\r\n                    </h1>\r\n                    <p style={{ fontSize: '1.2rem', color: '#94a3b8' }}>\r\n                        You have <span style={{ color: '#818cf8', fontWeight: 'bold' }}>{unreadCount}</span> unread alerts\r\n                    </p>\r\n                </div>\r\n                <div style={{ display: 'flex', gap: '15px' }}>\r\n                    {unreadCount > 0 && (\r\n                        <button onClick={markAllRead} className=\"btn-glow\" style={{ padding: '10px 20px', fontSize: '0.8rem' }}>\r\n                            <Bell size={16} /> MARK ALL AS READ\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Controls Section */}\r\n            <div style={{ padding: '20px 30px', borderRadius: '24px', marginBottom: '40px', display: 'flex', gap: '25px', alignItems: 'center', flexWrap: 'wrap', background: '#0f172a', border: '1px solid #1e293b', boxShadow: '0 10px 30px rgba(0,0,0,0.3)' }}>\r\n                <div style={{ position: 'relative', flex: '1', minWidth: '300px' }}>\r\n                    <Search size={20} style={{ position: 'absolute', left: '18px', top: '50%', transform: 'translateY(-50%)', opacity: '0.4' }} />\r\n                    <input\r\n                        className=\"input-glass\"\r\n                        placeholder=\"Search your alerts...\"\r\n                        style={{ paddingLeft: '50px', width: '100%', background: 'rgba(255,255,255,0.03)' }}\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                    />\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>\r\n                    <Filter size={20} className=\"text-muted\" />\r\n                    <select\r\n                        className=\"input-glass\"\r\n                        style={{ padding: '10px 20px', width: '180px', background: 'rgba(255,255,255,0.03)' }}\r\n                        value={filter}\r\n                        onChange={(e) => setFilter(e.target.value)}\r\n                    >\r\n                        <option value=\"all\">Everything</option>\r\n                        <option value=\"attendance\">Attendance</option>\r\n                        <option value=\"absence\">Absences</option>\r\n                        <option value=\"class\">Class News</option>\r\n                        <option value=\"assignment\">Assignments</option>\r\n                        <option value=\"note\">Study Material</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Notifications List */}\r\n            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\r\n                {filteredNotifications.length === 0 ? (\r\n                    <div style={{ padding: '100px', flexDirection: 'column', gap: '25px', display: 'flex', alignItems: 'center', justifyContent: 'center', background: '#0f172a', border: '1px solid #1e293b', borderRadius: '24px' }}>\r\n                        <Bell size={64} style={{ opacity: '0.1', color: 'var(--accent-primary)' }} />\r\n                        <p className=\"text-muted\" style={{ fontSize: '1.2rem' }}>All caught up! No notifications found.</p>\r\n                    </div>\r\n                ) : (\r\n                    filteredNotifications.map((n, index) => (\r\n                        <div\r\n                            key={n._id}\r\n                            onClick={() => {\r\n                                markAsRead(n._id);\r\n                                if (n.link) navigate(n.link);\r\n                            }}\r\n                            className=\"glass-panel card fade-in\"\r\n                            style={{\r\n                                padding: '25px 35px',\r\n                                display: 'grid',\r\n                                gridTemplateColumns: 'auto 1fr auto',\r\n                                gap: '30px',\r\n                                alignItems: 'center',\r\n                                cursor: 'pointer',\r\n                                transition: 'all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)',\r\n                                background: n.isRead ? '#111827' : '#1e1b4b',\r\n                                border: n.isRead ? '1px solid #1f2937' : '1px solid #6366f1',\r\n                                position: 'relative',\r\n                                opacity: n.isRead ? 0.9 : 1,\r\n                                animationDelay: `${index * 0.05}s`,\r\n                                boxShadow: n.isRead ? 'none' : '0 10px 40px -10px rgba(99, 102, 241, 0.5)'\r\n                            }}\r\n                        >\r\n                            <div style={{\r\n                                width: '60px',\r\n                                height: '60px',\r\n                                borderRadius: '20px',\r\n                                background: n.isRead ? 'rgba(255,255,255,0.03)' : 'rgba(99, 102, 241, 0.1)',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                border: '1px solid rgba(255,255,255,0.05)'\r\n                            }}>\r\n                                {getIcon(n.type)}\r\n                            </div>\r\n\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\r\n                                <div style={{ display: 'flex', alignItems: 'center', flexWrap: 'wrap', gap: '15px' }}>\r\n                                    <h4 style={{ margin: 0, fontSize: '1.2rem', fontWeight: '700', color: 'white' }}>{n.title}</h4>\r\n                                    <span style={{ fontSize: '0.8rem', color: '#cbd5e1' }}>\r\n                                        {new Date(n.createdAt).toLocaleDateString(undefined, { month: 'short', day: 'numeric' })}  {new Date(n.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                    </span>\r\n                                </div>\r\n                                <p style={{ margin: 0, fontSize: '1rem', color: '#e2e8f0', lineHeight: '1.5' }}>{n.message}</p>\r\n                            </div>\r\n\r\n                            <div style={{ display: 'flex', gap: '20px', alignItems: 'center' }}>\r\n                                <button\r\n                                    onClick={(e) => deleteNotification(n._id, e)}\r\n                                    style={{\r\n                                        padding: '12px',\r\n                                        borderRadius: '15px',\r\n                                        background: 'rgba(239, 68, 68, 0.05)',\r\n                                        border: '1px solid rgba(239, 68, 68, 0.1)',\r\n                                        color: '#ef4444',\r\n                                        cursor: 'pointer',\r\n                                        transition: '0.3s'\r\n                                    }}\r\n                                    className=\"delete-hover\"\r\n                                    title=\"Dismiss\"\r\n                                >\r\n                                    <Trash2 size={18} />\r\n                                </button>\r\n                                {n.link && <ChevronRight size={24} style={{ opacity: 0.3 }} />}\r\n                            </div>\r\n\r\n                            {!n.isRead && (\r\n                                <div style={{\r\n                                    position: 'absolute', top: '20px', right: '20px',\r\n                                    width: '12px', height: '12px', background: 'var(--accent-secondary)', borderRadius: '50%',\r\n                                    boxShadow: '0 0 15px var(--accent-secondary)'\r\n                                }}></div>\r\n                            )}\r\n                        </div>\r\n                    ))\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Notifications;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\src_old\\pages\\Profile.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":6,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":17,"suggestions":[{"messageId":"removeVar","data":{"varName":"user"},"fix":{"range":[213,218],"text":""},"desc":"Remove unused variable 'user'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'login' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":6,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":29,"suggestions":[{"messageId":"removeVar","data":{"varName":"login"},"fix":{"range":[222,229],"text":""},"desc":"Remove unused variable 'login'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'res' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":61,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":61,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"res"},"fix":{"range":[2126,2180],"text":""},"desc":"Remove unused variable 'res'."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { User, Mail, Hash, Camera, Save, AlertCircle } from 'lucide-react';\r\n\r\nconst Profile = () => {\r\n    const { user, api, login } = useAuth();\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        email: '',\r\n        universityRollNo: '',\r\n        classRollNo: '',\r\n        profilePic: '',\r\n        university: ''\r\n    });\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const [message, setMessage] = useState({ type: '', text: '' });\r\n\r\n    useEffect(() => {\r\n        const fetchProfile = async () => {\r\n            try {\r\n                const res = await api.get('/users/profile');\r\n                setFormData({\r\n                    name: res.data.name || '',\r\n                    email: res.data.email || '',\r\n                    universityRollNo: res.data.universityRollNo || '',\r\n                    classRollNo: res.data.classRollNo || '',\r\n                    profilePic: res.data.profilePic || '',\r\n                    university: res.data.institutionId?.name || 'Default University'\r\n                });\r\n            } catch (err) {\r\n                console.error('Error fetching profile:', err);\r\n                setMessage({ type: 'error', text: 'Failed to load profile' });\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchProfile();\r\n    }, [api]);\r\n\r\n    const handleChange = (e) => {\r\n        setFormData({ ...formData, [e.target.name]: e.target.value });\r\n    };\r\n\r\n    const handleFileChange = (e) => {\r\n        const file = e.target.files[0];\r\n        if (file) {\r\n            const reader = new FileReader();\r\n            reader.onloadend = () => {\r\n                setFormData({ ...formData, profilePic: reader.result });\r\n            };\r\n            reader.readAsDataURL(file);\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setSaving(true);\r\n        setMessage({ type: '', text: '' });\r\n        try {\r\n            const res = await api.put('/users/profile', formData);\r\n            setMessage({ type: 'success', text: 'Profile updated successfully!' });\r\n            // Optionally update the context user if needed, but the context usually holds token info\r\n            // If the context holds the full user, we might need a way to refresh it.\r\n            // For now, assume we just update the local state.\r\n        } catch (err) {\r\n            console.error('Error updating profile:', err);\r\n            setMessage({ type: 'error', text: err.response?.data?.msg || 'Failed to update profile' });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"flex-center\" style={{ height: '80vh' }}><div className=\"loader\"></div></div>;\r\n\r\n    return (\r\n        <div className=\"content-wrapper fade-in\" style={{ padding: '40px 20px', maxWidth: '800px', margin: '0 auto' }}>\r\n            <div style={{ marginBottom: '30px' }}>\r\n                <h1 style={{ fontSize: '2.5rem', fontWeight: '800' }}>\r\n                    Student <span className=\"text-gradient\">Profile</span>\r\n                </h1>\r\n                <p className=\"text-muted\">Keep your academic information up to date.</p>\r\n            </div>\r\n\r\n            <div className=\"glass-panel\" style={{ padding: '40px' }}>\r\n                <form onSubmit={handleSubmit}>\r\n                    {/* Profile Photo Section */}\r\n                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', marginBottom: '40px' }}>\r\n                        <div style={{ position: 'relative', width: '150px', height: '150px', borderRadius: '50%', overflow: 'hidden', border: '3px solid var(--accent-primary)', marginBottom: '15px', background: 'rgba(255,255,255,0.05)' }} className=\"flex-center\">\r\n                            {formData.profilePic ? (\r\n                                <img src={formData.profilePic} alt=\"Profile\" style={{ width: '100%', height: '100%', objectFit: 'cover' }} />\r\n                            ) : (\r\n                                <User size={80} style={{ opacity: 0.2 }} />\r\n                            )}\r\n                            <label htmlFor=\"profile-upload\" style={{ position: 'absolute', bottom: 0, width: '100%', background: 'rgba(0,0,0,0.6)', color: 'white', padding: '5px', fontSize: '0.7rem', textAlign: 'center', cursor: 'pointer' }}>\r\n                                <Camera size={14} style={{ marginRight: '5px' }} /> CHANGE\r\n                            </label>\r\n                            <input id=\"profile-upload\" type=\"file\" accept=\"image/*\" onChange={handleFileChange} style={{ display: 'none' }} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div style={{ marginBottom: '20px' }}>\r\n                        <label className=\"text-muted\" style={{ fontSize: '0.8rem', display: 'block', marginBottom: '8px' }}>University / Institution</label>\r\n                        <div style={{ position: 'relative' }}>\r\n                            <AlertCircle size={18} style={{ position: 'absolute', left: '15px', top: '50%', transform: 'translateY(-50%)', opacity: 0.4 }} />\r\n                            <input\r\n                                type=\"text\" name=\"university\" className=\"input-glass\" value={formData.university}\r\n                                style={{ paddingLeft: '45px', opacity: 0.7, cursor: 'not-allowed' }} readOnly\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginBottom: '20px' }}>\r\n                        <div>\r\n                            <label className=\"text-muted\" style={{ fontSize: '0.8rem', display: 'block', marginBottom: '8px' }}>Full Name</label>\r\n                            <div style={{ position: 'relative' }}>\r\n                                <User size={18} style={{ position: 'absolute', left: '15px', top: '50%', transform: 'translateY(-50%)', opacity: 0.4 }} />\r\n                                <input\r\n                                    type=\"text\" name=\"name\" className=\"input-glass\" value={formData.name} onChange={handleChange}\r\n                                    style={{ paddingLeft: '45px' }} required\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-muted\" style={{ fontSize: '0.8rem', display: 'block', marginBottom: '8px' }}>Email Address</label>\r\n                            <div style={{ position: 'relative' }}>\r\n                                <Mail size={18} style={{ position: 'absolute', left: '15px', top: '50%', transform: 'translateY(-50%)', opacity: 0.4 }} />\r\n                                <input\r\n                                    type=\"email\" name=\"email\" className=\"input-glass\" value={formData.email} onChange={handleChange}\r\n                                    style={{ paddingLeft: '45px' }} required\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginBottom: '30px' }}>\r\n                        <div>\r\n                            <label className=\"text-muted\" style={{ fontSize: '0.8rem', display: 'block', marginBottom: '8px' }}>University Roll No.</label>\r\n                            <div style={{ position: 'relative' }}>\r\n                                <Hash size={18} style={{ position: 'absolute', left: '15px', top: '50%', transform: 'translateY(-50%)', opacity: 0.4 }} />\r\n                                <input\r\n                                    type=\"text\" name=\"universityRollNo\" className=\"input-glass\" value={formData.universityRollNo} onChange={handleChange}\r\n                                    style={{ paddingLeft: '45px' }} placeholder=\"e.g. 2100101010\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-muted\" style={{ fontSize: '0.8rem', display: 'block', marginBottom: '8px' }}>Class Roll No.</label>\r\n                            <div style={{ position: 'relative' }}>\r\n                                <Hash size={18} style={{ position: 'absolute', left: '15px', top: '50%', transform: 'translateY(-50%)', opacity: 0.4 }} />\r\n                                <input\r\n                                    type=\"text\" name=\"classRollNo\" className=\"input-glass\" value={formData.classRollNo} onChange={handleChange}\r\n                                    style={{ paddingLeft: '45px' }} placeholder=\"e.g. CS-01\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {message.text && (\r\n                        <div style={{\r\n                            padding: '15px',\r\n                            borderRadius: '12px',\r\n                            marginBottom: '20px',\r\n                            background: message.type === 'success' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)',\r\n                            border: `1px solid ${message.type === 'success' ? 'var(--status-success)' : 'var(--status-critical)'}`,\r\n                            color: message.type === 'success' ? 'var(--status-success)' : 'var(--status-critical)',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            gap: '10px'\r\n                        }}>\r\n                            <AlertCircle size={18} />\r\n                            {message.text}\r\n                        </div>\r\n                    )}\r\n\r\n                    <button type=\"submit\" className=\"btn-glow\" style={{ width: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '10px' }} disabled={saving}>\r\n                        {saving ? <div className=\"loader\" style={{ width: '20px', height: '20px', borderThickness: '2px' }}></div> : <Save size={18} />}\r\n                        {saving ? 'Saving...' : 'Update Profile'}\r\n                    </button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Profile;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\test_db.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\test_register.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\tmp_ui_repo\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\xampp\\htdocs\\Attendance_Website\\vite.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]